{
  "name": "Telegram Mini App - Xu·∫•t Nh·∫≠p H√†ng API",
  "nodes": [
    {
      "parameters": {
        "html": "<!DOCTYPE html>\n<html lang=\"vi\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no\">\n    <title>Xu·∫•t Nh·∫≠p H√†ng - RR88/XX88/MM88</title>\n    <script src=\"https://telegram.org/js/telegram-web-app.js\"></script>\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js\"></script>\n    <script src=\"https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js\"></script>\n    <style>\n        /* ============================================\n           üçé APPLE DESIGN SYSTEM - RESET & BASE\n           ============================================ */\n        * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n        }\n\n        :root {\n            /* üé® Apple iOS Colors - Light Mode */\n            --apple-blue: #007AFF;\n            --apple-purple: #5856D6;\n            --apple-green: #34C759;\n            --apple-orange: #FF9500;\n            --apple-red: #FF3B30;\n            --apple-pink: #FF2D55;\n            --apple-teal: #5AC8FA;\n            --apple-yellow: #FFCC00;\n            \n            /* üé≠ Semantic Colors */\n            --primary: var(--apple-blue);\n            --secondary: var(--apple-purple);\n            --success: var(--apple-green);\n            --warning: var(--apple-orange);\n            --danger: var(--apple-red);\n            \n            /* üìÑ Backgrounds - Light (Darker for better contrast) */\n            --bg-primary: #E5E5EA;\n            --bg-secondary: #FFFFFF;\n            --bg-tertiary: #F2F2F7;\n            --bg-elevated: rgba(255, 255, 255, 0.95);\n            --bg-frosted: rgba(255, 255, 255, 0.8);\n            \n            /* üìù Text Colors - Light */\n            --text-primary: #000000;\n            --text-secondary: #3C3C43;\n            --text-tertiary: #6C6C70;\n            --text-quaternary: #AEAEB2;\n            \n            /* üé® UI Elements */\n            --separator: rgba(60, 60, 67, 0.18);\n            --border: rgba(0, 0, 0, 0.08);\n            \n            /* üåì Shadows - Soft Apple Style */\n            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.06);\n            --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.1);\n            --shadow-lg: 0 10px 40px rgba(0, 0, 0, 0.15);\n            --shadow-card: 0 2px 8px rgba(0, 0, 0, 0.08);\n            \n            /* üìê Spacing - 8pt Grid (Compact) */\n            --space-xs: 6px;\n            --space-sm: 12px;\n            --space-md: 18px;\n            --space-lg: 24px;\n            --space-xl: 32px;\n            \n            /* üî§ Typography */\n            --font-family: -apple-system, BlinkMacSystemFont, \"SF Pro Display\", \"SF Pro Text\", \"Helvetica Neue\", Arial, sans-serif;\n            --border-radius: 10px;\n            --border-radius-lg: 16px;\n        }\n\n        /* üåô Dark Mode - Apple Style */\n        [data-theme=\"dark\"] {\n            /* üìÑ Backgrounds - Dark */\n            --bg-primary: #000000;\n            --bg-secondary: #1C1C1E;\n            --bg-tertiary: #2C2C2E;\n            --bg-elevated: rgba(28, 28, 30, 0.9);\n            --bg-frosted: rgba(28, 28, 30, 0.72);\n            \n            /* üìù Text Colors - Dark */\n            --text-primary: #FFFFFF;\n            --text-secondary: #EBEBF5;\n            --text-tertiary: #AEAEB2;\n            --text-quaternary: #6C6C70;\n            \n            /* üé® UI Elements - Dark */\n            --separator: rgba(235, 235, 245, 0.12);\n            --border: rgba(255, 255, 255, 0.04);\n            \n            /* üåì Shadows - Dark Mode */\n            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.3);\n            --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.4);\n            --shadow-lg: 0 10px 40px rgba(0, 0, 0, 0.5);\n            --shadow-card: 0 2px 8px rgba(0, 0, 0, 0.3);\n        }\n\n        /* ============================================\n           üéØ BASE STYLES\n           ============================================ */\n        body {\n            font-family: var(--font-family);\n            background: var(--bg-primary);\n            min-height: 100vh;\n            color: var(--text-primary);\n            -webkit-font-smoothing: antialiased;\n            -moz-osx-font-smoothing: grayscale;\n            overflow-x: hidden;\n        }\n\n        .container {\n            max-width: 600px;\n            margin: 0 auto;\n            min-height: 100vh;\n            background: var(--bg-primary);\n        }\n\n        /* ============================================\n           üì± HEADER - Frosted Glass Style\n           ============================================ */\n        .header {\n            position: sticky;\n            top: 0;\n            z-index: 100;\n            background: var(--bg-frosted);\n            backdrop-filter: saturate(180%) blur(20px);\n            -webkit-backdrop-filter: saturate(180%) blur(20px);\n            padding: var(--space-sm);\n            border-bottom: 1px solid var(--separator);\n            animation: slideDown 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);\n        }\n\n        @keyframes slideDown {\n            from {\n                transform: translateY(-100%);\n                opacity: 0;\n            }\n            to {\n                transform: translateY(0);\n                opacity: 1;\n            }\n        }\n\n        .header-title {\n            font-size: 20px;\n            font-weight: 700;\n            letter-spacing: -0.5px;\n            margin-bottom: 3px;\n            background: linear-gradient(135deg, var(--primary), var(--secondary));\n            -webkit-background-clip: text;\n            -webkit-text-fill-color: transparent;\n            background-clip: text;\n        }\n\n        .header-subtitle {\n            font-size: 12px;\n            color: var(--text-secondary);\n            font-weight: 500;\n        }\n\n        /* üîò Page Selector - iOS Style Pills (Enhanced) */\n        .page-selector {\n            display: flex;\n            gap: 5px;\n            margin-top: var(--space-sm);\n            background: var(--bg-tertiary);\n            padding: 3px;\n            border-radius: 8px;\n            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.08);\n        }\n\n        .page-btn {\n            flex: 1;\n            padding: 8px;\n            border: 1px solid transparent;\n            background: transparent;\n            color: var(--text-tertiary);\n            border-radius: 6px;\n            font-size: 14px;\n            font-weight: 600;\n            cursor: pointer;\n            transition: all 0.25s cubic-bezier(0.25, 0.46, 0.45, 0.94);\n            min-height: 36px;\n        }\n\n        .page-btn.active {\n            background: var(--primary);\n            color: white;\n            border-color: var(--primary);\n            box-shadow: 0 2px 8px rgba(0, 122, 255, 0.35), inset 0 1px 0 rgba(255, 255, 255, 0.2);\n            transform: scale(1.02);\n        }\n\n        /* ============================================\n           üß≠ NAVIGATION - iOS Tab Bar Style\n           ============================================ */\n        .nav {\n            display: grid;\n            grid-template-columns: repeat(3, 1fr);\n            gap: 8px;\n            padding: var(--space-sm);\n            background: var(--bg-secondary);\n            border-bottom: 1px solid var(--separator);\n        }\n\n        .nav-btn {\n            padding: 10px;\n            border: none;\n            background: var(--bg-tertiary);\n            border-radius: var(--border-radius);\n            cursor: pointer;\n            transition: all 0.25s cubic-bezier(0.25, 0.46, 0.45, 0.94);\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            gap: 5px;\n            min-height: 68px;\n        }\n\n        .nav-btn:active {\n            transform: scale(0.96);\n        }\n\n        .nav-btn.active {\n            background: var(--primary);\n            color: white;\n            box-shadow: 0 4px 12px rgba(0, 122, 255, 0.3);\n            transform: translateY(-2px);\n        }\n\n        .nav-btn-icon {\n            font-size: 24px;\n            line-height: 1;\n        }\n\n        .nav-btn-text {\n            font-size: 11px;\n            font-weight: 600;\n            opacity: 0.9;\n        }\n\n        /* ============================================\n           üì¶ CONTENT & SECTIONS\n           ============================================ */\n        .content {\n            padding: var(--space-sm);\n            animation: fadeIn 0.3s ease-out;\n        }\n\n        @keyframes fadeIn {\n            from { opacity: 0; transform: translateY(20px); }\n            to { opacity: 1; transform: translateY(0); }\n        }\n\n        .section {\n            display: none;\n        }\n\n        .section.active {\n            display: block;\n        }\n\n        /* üé¥ Card - Liquid Glass Morphism */\n        .card {\n            background: var(--bg-secondary);\n            border-radius: var(--border-radius-lg);\n            padding: var(--space-md);\n            margin-bottom: var(--space-sm);\n            box-shadow: var(--shadow-card);\n            border: 1px solid var(--border);\n            animation: slideUp 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);\n            position: relative;\n            overflow: hidden;\n        }\n\n        .card::before {\n            content: '';\n            position: absolute;\n            top: 0;\n            left: 0;\n            right: 0;\n            height: 1px;\n            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.5), transparent);\n            pointer-events: none;\n        }\n\n        @keyframes slideUp {\n            from { opacity: 0; transform: translateY(30px); }\n            to { opacity: 1; transform: translateY(0); }\n        }\n\n        .card-title {\n            font-size: 16px;\n            font-weight: 700;\n            margin-bottom: var(--space-sm);\n            color: var(--text-primary);\n            letter-spacing: -0.3px;\n        }\n\n        /* ============================================\n           üìù FORMS - Apple iOS Style\n           ============================================ */\n        .form-group {\n            margin-bottom: var(--space-sm);\n        }\n\n        .form-label {\n            display: block;\n            margin-bottom: 8px;\n            font-weight: 600;\n            font-size: 14px;\n            color: var(--text-secondary);\n            letter-spacing: -0.2px;\n        }\n\n        .form-control {\n            width: 100%;\n            padding: 14px 16px;\n            border: 1px solid var(--separator);\n            border-radius: 10px;\n            font-size: 16px;\n            background: var(--bg-tertiary);\n            color: var(--text-primary);\n            transition: all 0.2s ease;\n            font-family: var(--font-family);\n        }\n\n        .form-control:focus {\n            outline: none;\n            border-color: var(--primary);\n            background: var(--bg-secondary);\n            box-shadow: 0 0 0 4px rgba(0, 122, 255, 0.1);\n        }\n\n        select.form-control {\n            -webkit-appearance: none;\n            -moz-appearance: none;\n            appearance: none;\n            background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23007AFF' d='M10.293 3.293L6 7.586 1.707 3.293A1 1 0 00.293 4.707l5 5a1 1 0 001.414 0l5-5a1 1 0 10-1.414-1.414z'/%3E%3C/svg%3E\");\n            background-repeat: no-repeat;\n            background-position: right 16px center;\n            padding-right: 40px;\n        }\n\n        /* ============================================\n           üîò BUTTONS - iOS Style\n           ============================================ */\n        .btn {\n            padding: 13px 20px;\n            border: none;\n            border-radius: 10px;\n            font-size: 16px;\n            font-weight: 600;\n            cursor: pointer;\n            transition: all 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);\n            display: inline-flex;\n            align-items: center;\n            justify-content: center;\n            gap: 7px;\n            width: 100%;\n            min-height: 46px;\n            letter-spacing: -0.3px;\n            position: relative;\n            overflow: hidden;\n        }\n\n        .btn::before {\n            content: '';\n            position: absolute;\n            inset: 0;\n            background: linear-gradient(135deg, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0));\n            opacity: 0;\n            transition: opacity 0.3s;\n        }\n\n        .btn:hover::before {\n            opacity: 1;\n        }\n\n        .btn:active {\n            transform: scale(0.97);\n        }\n\n        .btn-primary {\n            background: var(--primary);\n            color: white;\n            box-shadow: var(--shadow-md);\n        }\n\n        .btn-primary:hover {\n            opacity: 0.9;\n        }\n\n        .btn-success {\n            background: var(--success);\n            color: white;\n            box-shadow: var(--shadow-md);\n        }\n\n        .btn-danger {\n            background: var(--danger);\n            color: white;\n            box-shadow: var(--shadow-md);\n        }\n\n        .btn-secondary {\n            background: var(--bg-tertiary);\n            color: var(--text-primary);\n            border: 1px solid var(--separator);\n        }\n\n        .btn:disabled {\n            opacity: 0.5;\n            cursor: not-allowed;\n            transform: none !important;\n        }\n\n        .btn-sm {\n            padding: 9px 14px;\n            font-size: 14px;\n            min-height: 38px;\n            border-radius: 8px;\n        }\n\n        /* ============================================\n           üìä STATS GRID - Apple Cards\n           ============================================ */\n        .stats-grid {\n            display: grid;\n            grid-template-columns: repeat(2, 1fr);\n            gap: 12px;\n            margin-bottom: var(--space-sm);\n        }\n\n        .stat-card {\n            background: var(--bg-secondary);\n            border-radius: var(--border-radius);\n            padding: var(--space-sm);\n            box-shadow: var(--shadow-card);\n            border: 1px solid var(--border);\n            transition: transform 0.2s ease;\n        }\n\n        .stat-card:active {\n            transform: scale(0.98);\n        }\n\n        .stat-card.success {\n            border-left: 3px solid var(--success);\n        }\n\n        .stat-card.danger {\n            border-left: 3px solid var(--danger);\n        }\n\n        .stat-card.info {\n            border-left: 3px solid var(--primary);\n        }\n\n        .stat-value {\n            font-size: 28px;\n            font-weight: 700;\n            margin-bottom: 4px;\n            color: var(--text-primary);\n            letter-spacing: -0.5px;\n        }\n\n        .stat-label {\n            font-size: 13px;\n            color: var(--text-secondary);\n            font-weight: 500;\n        }\n\n        /* ============================================\n           üìã LIST ITEMS - iOS Style\n           ============================================ */\n        .list-item {\n            background: var(--bg-secondary);\n            border-radius: var(--border-radius);\n            padding: var(--space-sm);\n            margin-bottom: 10px;\n            box-shadow: var(--shadow-card);\n            border: 1px solid var(--border);\n            transition: all 0.2s ease;\n            position: relative;\n            overflow: hidden;\n        }\n\n        .list-item::before {\n            content: '';\n            position: absolute;\n            top: 0;\n            left: 0;\n            right: 0;\n            height: 1px;\n            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);\n            pointer-events: none;\n        }\n\n        .list-item:active {\n            transform: scale(0.98);\n        }\n\n        .list-item.nhap {\n            border-left: 3px solid var(--success);\n        }\n\n        .list-item.xuat {\n            border-left: 3px solid var(--danger);\n        }\n\n        .list-item-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 12px;\n        }\n\n        .list-item-title {\n            font-weight: 600;\n            font-size: 16px;\n            letter-spacing: -0.3px;\n        }\n\n        .list-item-badge {\n            padding: 6px 12px;\n            border-radius: 20px;\n            font-size: 12px;\n            font-weight: 600;\n            color: white;\n        }\n\n        .badge-nhap {\n            background: var(--success);\n        }\n\n        .badge-xuat {\n            background: var(--danger);\n        }\n\n        .list-item-details {\n            display: grid;\n            grid-template-columns: repeat(2, 1fr);\n            gap: 8px;\n            font-size: 14px;\n            color: var(--text-secondary);\n        }\n\n        /* ============================================\n           üîç SEARCH BOX\n           ============================================ */\n        .search-box {\n            position: relative;\n            margin-bottom: var(--space-sm);\n        }\n\n        .search-input {\n            width: 100%;\n            padding: 12px 44px 12px 40px;\n            border: 1px solid var(--separator);\n            border-radius: 10px;\n            font-size: 16px;\n            background: var(--bg-tertiary);\n            color: var(--text-primary);\n            transition: all 0.2s ease;\n        }\n\n        .search-input:focus {\n            outline: none;\n            border-color: var(--primary);\n            background: var(--bg-secondary);\n            box-shadow: 0 0 0 4px rgba(0, 122, 255, 0.1);\n        }\n\n        .search-icon {\n            position: absolute;\n            left: 14px;\n            top: 50%;\n            transform: translateY(-50%);\n            font-size: 18px;\n            color: var(--text-tertiary);\n        }\n\n        /* ============================================\n           ‚è≥ LOADING & TOAST\n           ============================================ */\n        .loading {\n            display: none;\n            text-align: center;\n            padding: var(--space-lg);\n        }\n\n        .loading.active {\n            display: block;\n        }\n\n        .spinner {\n            width: 48px;\n            height: 48px;\n            border: 3px solid var(--separator);\n            border-top-color: var(--primary);\n            border-radius: 50%;\n            animation: spin 0.8s linear infinite;\n            margin: 0 auto 16px;\n        }\n\n        @keyframes spin {\n            to { transform: rotate(360deg); }\n        }\n\n        .toast {\n            position: fixed;\n            bottom: 90px;\n            left: 50%;\n            transform: translateX(-50%) translateY(100px);\n            background: var(--bg-frosted);\n            backdrop-filter: saturate(180%) blur(20px);\n            -webkit-backdrop-filter: saturate(180%) blur(20px);\n            padding: 16px 24px;\n            border-radius: 16px;\n            box-shadow: var(--shadow-lg);\n            z-index: 1000;\n            opacity: 0;\n            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);\n            display: flex;\n            align-items: center;\n            gap: 12px;\n            max-width: 90%;\n            border: 1px solid var(--separator);\n        }\n\n        .toast.show {\n            opacity: 1;\n            transform: translateX(-50%) translateY(0);\n        }\n\n        .toast-icon {\n            font-size: 22px;\n        }\n\n        .toast-message {\n            font-weight: 500;\n            font-size: 15px;\n        }\n\n        .toast-success {\n            border-left: 3px solid var(--success);\n        }\n\n        .toast-error {\n            border-left: 3px solid var(--danger);\n        }\n\n        .toast-info {\n            border-left: 3px solid var(--primary);\n        }\n\n        /* ============================================\n           ‚ùå EMPTY STATE\n           ============================================ */\n        .empty-state {\n            text-align: center;\n            padding: var(--space-xl) var(--space-md);\n            color: var(--text-secondary);\n        }\n\n        .empty-state-icon {\n            font-size: 64px;\n            margin-bottom: var(--space-sm);\n            opacity: 0.5;\n        }\n\n        .empty-state-text {\n            font-size: 17px;\n            font-weight: 500;\n        }\n\n        /* ============================================\n           ü™ü MODAL - Apple Style\n           ============================================ */\n        .modal {\n            display: none;\n            position: fixed;\n            top: 0;\n            left: 0;\n            right: 0;\n            bottom: 0;\n            background: rgba(0, 0, 0, 0.4);\n            backdrop-filter: blur(10px);\n            -webkit-backdrop-filter: blur(10px);\n            z-index: 999;\n            animation: fadeIn 0.2s ease-out;\n        }\n\n        .modal.active {\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            padding: var(--space-md);\n        }\n\n        .modal-content {\n            background: var(--bg-secondary);\n            border-radius: var(--border-radius-lg);\n            padding: var(--space-md);\n            max-width: 500px;\n            width: 100%;\n            max-height: 80vh;\n            overflow-y: auto;\n            box-shadow: var(--shadow-lg);\n            animation: slideUp 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);\n            border: 1px solid var(--separator);\n        }\n\n        .modal-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: var(--space-md);\n        }\n\n        .modal-title {\n            font-size: 20px;\n            font-weight: 700;\n            letter-spacing: -0.4px;\n        }\n\n        .modal-close {\n            background: var(--bg-tertiary);\n            border: none;\n            font-size: 24px;\n            cursor: pointer;\n            color: var(--text-secondary);\n            width: 32px;\n            height: 32px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            border-radius: 50%;\n            transition: all 0.2s;\n        }\n\n        .modal-close:hover {\n            background: var(--separator);\n        }\n\n        .modal-close:active {\n            transform: scale(0.9);\n        }\n\n        /* ============================================\n           üìä TABLE - iOS Style\n           ============================================ */\n        .inventory-table {\n            width: 100%;\n            border-collapse: separate;\n            border-spacing: 0;\n            background: var(--bg-secondary);\n            border-radius: var(--border-radius);\n            overflow: hidden;\n            box-shadow: var(--shadow-card);\n            border: 1px solid var(--border);\n        }\n\n        .inventory-table th {\n            background: var(--bg-tertiary);\n            color: var(--text-primary);\n            padding: 14px 12px;\n            text-align: left;\n            font-size: 14px;\n            font-weight: 600;\n            border-bottom: 1px solid var(--separator);\n        }\n\n        .inventory-table td {\n            padding: 14px 12px;\n            border-bottom: 1px solid var(--separator);\n            font-size: 15px;\n        }\n\n        .inventory-table tr:last-child td {\n            border-bottom: none;\n        }\n\n        /* ============================================\n           üé® DASHBOARD NEW STYLES\n           ============================================ */\n        .time-filter-buttons {\n            display: grid;\n            grid-template-columns: repeat(3, 1fr);\n            gap: 8px;\n            margin-bottom: var(--space-sm);\n        }\n\n        .time-filter-btn {\n            padding: 10px;\n            border: 1px solid var(--separator);\n            background: var(--bg-secondary);\n            border-radius: 8px;\n            cursor: pointer;\n            transition: all 0.2s ease;\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            gap: 3px;\n            min-height: 64px;\n            position: relative;\n            overflow: hidden;\n        }\n\n        .time-filter-btn::before {\n            content: '';\n            position: absolute;\n            inset: 0;\n            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0));\n            opacity: 0;\n            transition: opacity 0.3s;\n        }\n\n        .time-filter-btn:hover::before {\n            opacity: 1;\n        }\n\n        .time-filter-btn:active {\n            transform: scale(0.96);\n        }\n\n        .time-filter-btn.active {\n            background: var(--primary);\n            color: white;\n            border-color: var(--primary);\n            box-shadow: 0 4px 12px rgba(0, 122, 255, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.2);\n        }\n\n        .filter-icon {\n            font-size: 20px;\n        }\n\n        .filter-label {\n            font-size: 14px;\n            font-weight: 600;\n        }\n\n        .filter-sublabel {\n            font-size: 10px;\n            opacity: 0.8;\n        }\n\n        .time-range-display {\n            padding: 14px;\n            background: var(--bg-tertiary);\n            border-radius: 10px;\n            text-align: center;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            gap: 8px;\n            font-size: 14px;\n            font-weight: 500;\n            border: 1px solid var(--border);\n        }\n\n        /* Summary Cards */\n        .summary-grid {\n            display: grid;\n            grid-template-columns: repeat(3, 1fr);\n            gap: 10px;\n        }\n\n        .summary-card {\n            background: var(--bg-secondary);\n            border-radius: var(--border-radius);\n            padding: 14px 10px;\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            text-align: center;\n            gap: 6px;\n            box-shadow: var(--shadow-card);\n            border: 1px solid var(--border);\n            border-top: 3px solid var(--primary);\n            position: relative;\n            overflow: hidden;\n        }\n\n        .summary-card::before {\n            content: '';\n            position: absolute;\n            top: 0;\n            left: 0;\n            right: 0;\n            height: 1px;\n            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.6), transparent);\n            pointer-events: none;\n        }\n\n        .summary-card.success {\n            border-top-color: var(--success);\n        }\n\n        .summary-card.danger {\n            border-top-color: var(--danger);\n        }\n\n        .summary-icon {\n            font-size: 28px;\n        }\n\n        .summary-label {\n            font-size: 11px;\n            color: var(--text-secondary);\n            font-weight: 500;\n        }\n\n        .summary-value {\n            font-size: 22px;\n            font-weight: 700;\n            color: var(--text-primary);\n            letter-spacing: -0.5px;\n        }\n\n        .summary-trend {\n            font-size: 12px;\n            font-weight: 600;\n            display: flex;\n            align-items: center;\n            gap: 4px;\n        }\n\n        .summary-trend.up {\n            color: var(--success);\n        }\n\n        .summary-trend.down {\n            color: var(--danger);\n        }\n\n        .summary-trend.neutral {\n            color: var(--text-tertiary);\n        }\n\n        /* Chart Styles */\n        .chart-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: var(--space-sm);\n        }\n\n        .chart-toggle {\n            display: flex;\n            gap: 6px;\n            background: var(--bg-tertiary);\n            padding: 4px;\n            border-radius: 8px;\n            border: 1px solid var(--separator);\n        }\n\n        .chart-toggle-btn {\n            padding: 8px 14px;\n            border: none;\n            background: transparent;\n            border-radius: 6px;\n            cursor: pointer;\n            transition: all 0.2s ease;\n            font-size: 14px;\n            font-weight: 600;\n            color: var(--text-secondary);\n        }\n\n        .chart-toggle-btn.active {\n            background: var(--primary);\n            color: white;\n            box-shadow: var(--shadow-sm);\n        }\n\n        .chart-canvas-wrapper {\n            position: relative;\n            height: 300px;\n            margin-bottom: var(--space-sm);\n        }\n\n        .detail-table {\n            width: 100%;\n            border-collapse: separate;\n            border-spacing: 0;\n            background: var(--bg-secondary);\n            border-radius: var(--border-radius);\n            overflow: hidden;\n            border: 1px solid var(--border);\n        }\n\n        .detail-table th {\n            background: var(--bg-tertiary);\n            color: var(--text-primary);\n            padding: 12px;\n            text-align: left;\n            font-size: 13px;\n            font-weight: 600;\n            border-bottom: 1px solid var(--separator);\n        }\n\n        .detail-table td {\n            padding: 12px;\n            border-bottom: 1px solid var(--separator);\n            font-size: 14px;\n        }\n\n        .detail-table tr:last-child td {\n            border-bottom: none;\n        }\n\n        .product-name {\n            font-weight: 600;\n        }\n\n        .quantity-nhap {\n            color: var(--success);\n            font-weight: 600;\n        }\n\n        .quantity-xuat {\n            color: var(--danger);\n            font-weight: 600;\n        }\n\n        .quantity-net {\n            font-weight: 700;\n        }\n\n        .quantity-net.positive {\n            color: var(--success);\n        }\n\n        .quantity-net.negative {\n            color: var(--danger);\n        }\n\n        /* Google Sheet Sync Styles */\n        .sync-progress {\n            text-align: center;\n            padding: var(--space-lg);\n        }\n\n        .sync-icon {\n            font-size: 64px;\n            margin-bottom: var(--space-sm);\n            animation: bounce 1s infinite;\n        }\n\n        @keyframes bounce {\n            0%, 100% { transform: translateY(0); }\n            50% { transform: translateY(-10px); }\n        }\n\n        .sync-message {\n            font-size: 17px;\n            font-weight: 600;\n            color: var(--text-primary);\n        }\n\n        .gsheet-info {\n            background: var(--bg-tertiary);\n            border-radius: 10px;\n            padding: var(--space-sm);\n            margin: var(--space-md) 0;\n            text-align: left;\n            border: 1px solid var(--border);\n        }\n\n        /* ============================================\n           üìÖ DATE SECTION HEADER - iOS Style\n           ============================================ */\n        .date-section {\n            margin-bottom: 12px;\n        }\n\n        .date-header {\n            position: sticky;\n            top: 128px;\n            background: var(--bg-frosted);\n            backdrop-filter: saturate(180%) blur(20px);\n            -webkit-backdrop-filter: saturate(180%) blur(20px);\n            padding: 10px 16px;\n            margin-bottom: 12px;\n            border-radius: 10px;\n            font-size: 14px;\n            font-weight: 700;\n            color: var(--text-primary);\n            letter-spacing: -0.2px;\n            border: 1px solid var(--separator);\n            z-index: 50;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n        }\n\n        .date-icon {\n            font-size: 16px;\n        }\n\n        .date-transactions {\n            display: flex;\n            flex-direction: column;\n            gap: 10px;\n        }\n\n        /* ============================================\n           üõ†Ô∏è ACTION BUTTONS - iOS Style\n           ============================================ */\n        .action-btns {\n            display: flex;\n            gap: 6px;\n        }\n\n        /* ============================================\n           üì¶ BULK IMPORT/EXPORT STYLES\n           ============================================ */\n        .bulk-item {\n            background: var(--bg-tertiary);\n            border-radius: 8px;\n            padding: 12px;\n            margin-bottom: 8px;\n            border: 1px solid var(--separator);\n            display: grid;\n            grid-template-columns: 2fr 1fr auto;\n            gap: 10px;\n            align-items: center;\n        }\n\n        .bulk-item-name {\n            font-weight: 600;\n            font-size: 14px;\n        }\n\n        .bulk-item-quantity {\n            display: flex;\n            align-items: center;\n            gap: 6px;\n        }\n\n        .bulk-qty-input {\n            width: 70px;\n            padding: 6px 8px;\n            border: 1px solid var(--separator);\n            border-radius: 6px;\n            font-size: 14px;\n            text-align: center;\n            background: var(--bg-secondary);\n            color: var(--text-primary);\n        }\n\n        .bulk-remove-btn {\n            padding: 6px;\n            background: var(--danger);\n            color: white;\n            border: none;\n            border-radius: 6px;\n            cursor: pointer;\n            font-size: 16px;\n            min-width: 32px;\n            min-height: 32px;\n        }\n\n        .bulk-add-row {\n            padding: 12px;\n            background: var(--bg-tertiary);\n            border: 2px dashed var(--separator);\n            border-radius: 8px;\n            text-align: center;\n            cursor: pointer;\n            transition: all 0.2s;\n            font-weight: 600;\n            color: var(--primary);\n        }\n\n        .bulk-add-row:hover {\n            background: var(--bg-secondary);\n            border-color: var(--primary);\n        }\n\n        .bulk-summary {\n            background: var(--bg-tertiary);\n            border-radius: 10px;\n            padding: 14px;\n            margin: 16px 0;\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            border: 1px solid var(--border);\n        }\n\n        .bulk-summary-label {\n            font-size: 14px;\n            font-weight: 600;\n            color: var(--text-secondary);\n        }\n\n        .bulk-summary-value {\n            font-size: 20px;\n            font-weight: 700;\n            color: var(--primary);\n        }\n\n        /* ============================================\n           üåô DARK MODE TEXT FIX\n           ============================================ */\n        [data-theme=\"dark\"] .nav-btn {\n            color: var(--text-secondary);\n        }\n\n        [data-theme=\"dark\"] .nav-btn.active {\n            color: white;\n        }\n\n        [data-theme=\"dark\"] .page-btn {\n            color: var(--text-secondary);\n        }\n\n        [data-theme=\"dark\"] .page-btn.active {\n            color: white !important;\n        }\n\n        [data-theme=\"dark\"] .time-filter-btn {\n            color: var(--text-secondary);\n        }\n\n        [data-theme=\"dark\"] .time-filter-btn.active {\n            color: white;\n        }\n\n        [data-theme=\"dark\"] .chart-toggle-btn {\n            color: var(--text-secondary);\n        }\n\n        [data-theme=\"dark\"] .chart-toggle-btn.active {\n            color: white;\n        }\n\n        /* ============================================\n           üì± RESPONSIVE - Mobile First\n           ============================================ */\n        @media (max-width: 480px) {\n            .header {\n                padding: 14px;\n            }\n            \n            .header-title {\n                font-size: 20px;\n            }\n            \n            .nav {\n                grid-template-columns: repeat(2, 1fr);\n                gap: 8px;\n                padding: 12px;\n            }\n            \n            .nav-btn {\n                min-height: 70px;\n            }\n            \n            .content {\n                padding: 12px;\n            }\n            \n            .card {\n                padding: var(--space-sm);\n            }\n            \n            .summary-grid {\n                gap: 8px;\n            }\n            \n            .summary-card {\n                padding: 12px 10px;\n            }\n            \n            .summary-value {\n                font-size: 22px;\n            }\n            \n            .chart-canvas-wrapper {\n                height: 250px;\n            }\n        }\n        \n        /* Desktop - Better utilization */\n        @media (min-width: 768px) {\n            .container {\n                max-width: 768px;\n            }\n            \n            .nav {\n                grid-template-columns: repeat(6, 1fr);\n            }\n            \n            .stats-grid {\n                grid-template-columns: repeat(4, 1fr);\n            }\n        }\n\n        /* ============================================\n           ‚ú® APPLE MICRO-INTERACTIONS\n           ============================================ */\n        .card:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);\n        }\n\n        .nav-btn:hover,\n        .page-btn:hover,\n        .time-filter-btn:hover {\n            transform: translateY(-1px);\n        }\n\n        /* Smooth transitions for all interactive elements */\n        a, button, .btn, .card, .list-item, .nav-btn, .page-btn {\n            transition: all 0.25s cubic-bezier(0.25, 0.46, 0.45, 0.94);\n        }\n\n        /* Focus visible for accessibility */\n        *:focus-visible {\n            outline: 2px solid var(--primary);\n            outline-offset: 2px;\n        }\n    </style>\n</head>\n<body>\n    <div class=\"container\">\n        <!-- Header -->\n        <div class=\"header\">\n            <div class=\"header-title\">üì¶ Qu·∫£n L√Ω Xu·∫•t Nh·∫≠p H√†ng</div>\n            <div class=\"header-subtitle\">H·ªá th·ªëng qu·∫£n l√Ω kho h√†ng chuy√™n nghi·ªáp</div>\n            \n            <!-- Page Selector -->\n            <div class=\"page-selector\">\n                <button class=\"page-btn active\" data-page=\"RR88\">RR88</button>\n                <button class=\"page-btn\" data-page=\"XX88\">XX88</button>\n                <button class=\"page-btn\" data-page=\"MM88\">MM88</button>\n            </div>\n        </div>\n\n        <!-- Navigation -->\n        <div class=\"nav\">\n            <button class=\"nav-btn active\" data-section=\"dashboard\">\n                <span class=\"nav-btn-icon\">üìä</span>\n                <span class=\"nav-btn-text\">T·ªïng Quan</span>\n            </button>\n            <button class=\"nav-btn\" data-section=\"nhap\">\n                <span class=\"nav-btn-icon\">üì•</span>\n                <span class=\"nav-btn-text\">Nh·∫≠p H√†ng</span>\n            </button>\n            <button class=\"nav-btn\" data-section=\"xuat\">\n                <span class=\"nav-btn-icon\">üì§</span>\n                <span class=\"nav-btn-text\">Xu·∫•t H√†ng</span>\n            </button>\n            <button class=\"nav-btn\" data-section=\"tonkho\">\n                <span class=\"nav-btn-icon\">üìã</span>\n                <span class=\"nav-btn-text\">T·ªìn Kho</span>\n            </button>\n            <button class=\"nav-btn\" data-section=\"lichsu\">\n                <span class=\"nav-btn-icon\">üïê</span>\n                <span class=\"nav-btn-text\">L·ªãch S·ª≠</span>\n            </button>\n            <button class=\"nav-btn\" data-section=\"danhmuc\">\n                <span class=\"nav-btn-icon\">‚öôÔ∏è</span>\n                <span class=\"nav-btn-text\">Danh M·ª•c</span>\n            </button>\n        </div>\n\n        <!-- Content -->\n        <div class=\"content\">\n            <!-- Dashboard Section -->\n            <div class=\"section active\" id=\"dashboard\">\n                <!-- Time Filter -->\n                <div class=\"card\">\n                    <div class=\"card-title\">üîç B·ªô L·ªçc Th·ªùi Gian</div>\n                    <div class=\"time-filter-buttons\">\n                        <button class=\"time-filter-btn\" data-filter=\"day\">\n                            <span class=\"filter-icon\">üìÖ</span>\n                            <span class=\"filter-label\">Ng√†y</span>\n                            <span class=\"filter-sublabel\">24h g·∫ßn nh·∫•t</span>\n                        </button>\n                        <button class=\"time-filter-btn active\" data-filter=\"week\">\n                            <span class=\"filter-icon\">üìÖ</span>\n                            <span class=\"filter-label\">Tu·∫ßn</span>\n                            <span class=\"filter-sublabel\">7 ng√†y g·∫ßn nh·∫•t</span>\n                        </button>\n                        <button class=\"time-filter-btn\" data-filter=\"month\">\n                            <span class=\"filter-icon\">üìÖ</span>\n                            <span class=\"filter-label\">Th√°ng</span>\n                            <span class=\"filter-sublabel\">Th√°ng hi·ªán t·∫°i</span>\n                        </button>\n                    </div>\n                    <div class=\"time-range-display\" id=\"time-range-display\">\n                        <span class=\"time-icon\">üìä</span>\n                        <span id=\"time-range-text\">ƒêang t·∫£i...</span>\n                    </div>\n                </div>\n\n                <!-- Summary Cards with Trends -->\n                <div class=\"card\">\n                    <div class=\"card-title\">üìä T·ªïng H·ª£p</div>\n                    <div class=\"summary-grid\">\n                        <div class=\"summary-card success\">\n                            <div class=\"summary-icon\">üì•</div>\n                            <div class=\"summary-content\">\n                                <div class=\"summary-label\">T·ªïng Nh·∫≠p</div>\n                                <div class=\"summary-value\" id=\"summary-nhap\">0</div>\n                                <div class=\"summary-trend\" id=\"trend-nhap\">\n                                    <span class=\"trend-icon\">‚Äï</span>\n                                    <span class=\"trend-text\">N/A</span>\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"summary-card danger\">\n                            <div class=\"summary-icon\">üì§</div>\n                            <div class=\"summary-content\">\n                                <div class=\"summary-label\">T·ªïng Xu·∫•t</div>\n                                <div class=\"summary-value\" id=\"summary-xuat\">0</div>\n                                <div class=\"summary-trend\" id=\"trend-xuat\">\n                                    <span class=\"trend-icon\">‚Äï</span>\n                                    <span class=\"trend-text\">N/A</span>\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"summary-card info\">\n                            <div class=\"summary-icon\">üì¶</div>\n                            <div class=\"summary-content\">\n                                <div class=\"summary-label\">Net</div>\n                                <div class=\"summary-value\" id=\"summary-net\">0</div>\n                                <div class=\"summary-trend\" id=\"trend-net\">\n                                    <span class=\"trend-icon\">‚Äï</span>\n                                    <span class=\"trend-text\">N/A</span>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                <!-- Chart Section -->\n                <div class=\"card\">\n                    <div class=\"chart-header\">\n                        <div class=\"card-title\">üìä Bi·ªÉu ƒê·ªì Xu·∫•t Nh·∫≠p</div>\n                        <div class=\"chart-toggle\">\n                            <button class=\"chart-toggle-btn active\" data-chart=\"bar\">\n                                <span>üìä</span>\n                                <span>C·ªôt</span>\n                            </button>\n                            <button class=\"chart-toggle-btn\" data-chart=\"pie\">\n                                <span>ü•ß</span>\n                                <span>Tr√≤n</span>\n                            </button>\n                        </div>\n                    </div>\n                    <div class=\"chart-canvas-wrapper\">\n                        <canvas id=\"main-chart\"></canvas>\n                    </div>\n                </div>\n\n                <!-- Detail Table -->\n                <div class=\"card\">\n                    <div class=\"card-title\">üìã Chi Ti·∫øt Theo S·∫£n Ph·∫©m</div>\n                    <div id=\"detail-table-container\"></div>\n                </div>\n            </div>\n\n            <!-- Nhap Hang Section -->\n            <div class=\"section\" id=\"nhap\">\n                <div class=\"card\">\n                    <div class=\"card-title\">üì• Nh·∫≠p H√†ng M·ªõi</div>\n                    <div style=\"text-align: right; margin-bottom: 12px;\">\n                        <button type=\"button\" class=\"btn btn-secondary btn-sm\" onclick=\"switchToBulkNhap()\" style=\"width: auto; min-width: 140px;\">\n                            <span>üì¶</span>\n                            <span>Nh·∫≠p Nhi·ªÅu</span>\n                        </button>\n                    </div>\n                    <form id=\"form-nhap\">\n                        <div class=\"form-group\">\n                            <label class=\"form-label\">S·∫£n Ph·∫©m</label>\n                            <select class=\"form-control\" id=\"nhap-product\" required>\n                                <option value=\"\">-- Ch·ªçn s·∫£n ph·∫©m --</option>\n                            </select>\n                        </div>\n                        <div class=\"form-group\">\n                            <label class=\"form-label\">S·ªë L∆∞·ª£ng</label>\n                            <input type=\"number\" class=\"form-control\" id=\"nhap-quantity\" min=\"1\" required>\n                        </div>\n                        <div class=\"form-group\">\n                            <label class=\"form-label\">Ghi Ch√∫</label>\n                            <input type=\"text\" class=\"form-control\" id=\"nhap-note\" placeholder=\"Ghi ch√∫ (kh√¥ng b·∫Øt bu·ªôc)\">\n                        </div>\n                        <button type=\"submit\" class=\"btn btn-success\">\n                            <span>‚úÖ</span>\n                            <span>Nh·∫≠p H√†ng</span>\n                        </button>\n                    </form>\n                </div>\n            </div>\n\n            <!-- Xuat Hang Section -->\n            <div class=\"section\" id=\"xuat\">\n                <div class=\"card\">\n                    <div class=\"card-title\">üì§ Xu·∫•t H√†ng</div>\n                    <div style=\"text-align: right; margin-bottom: 12px;\">\n                        <button type=\"button\" class=\"btn btn-secondary btn-sm\" onclick=\"switchToBulkXuat()\" style=\"width: auto; min-width: 140px;\">\n                            <span>üìÆ</span>\n                            <span>Xu·∫•t Nhi·ªÅu</span>\n                        </button>\n                    </div>\n                    <form id=\"form-xuat\">\n                        <div class=\"form-group\">\n                            <label class=\"form-label\">S·∫£n Ph·∫©m</label>\n                            <select class=\"form-control\" id=\"xuat-product\" required>\n                                <option value=\"\">-- Ch·ªçn s·∫£n ph·∫©m --</option>\n                            </select>\n                        </div>\n                        <div class=\"form-group\">\n                            <label class=\"form-label\">S·ªë L∆∞·ª£ng</label>\n                            <input type=\"number\" class=\"form-control\" id=\"xuat-quantity\" min=\"1\" required>\n                        </div>\n                        <div class=\"form-group\">\n                            <label class=\"form-label\">Ghi Ch√∫</label>\n                            <input type=\"text\" class=\"form-control\" id=\"xuat-note\" placeholder=\"Ghi ch√∫ (kh√¥ng b·∫Øt bu·ªôc)\">\n                        </div>\n                        <button type=\"submit\" class=\"btn btn-danger\">\n                            <span>‚úÖ</span>\n                            <span>Xu·∫•t H√†ng</span>\n                        </button>\n                    </form>\n                </div>\n            </div>\n\n            <!-- Nhap Hang Bulk Section -->\n            <div class=\"section\" id=\"nhap-bulk\">\n                <div class=\"card\">\n                    <div class=\"card-title\">üì¶ Nh·∫≠p Nhi·ªÅu S·∫£n Ph·∫©m</div>\n                    <div style=\"text-align: right; margin-bottom: 12px;\">\n                        <button type=\"button\" class=\"btn btn-secondary btn-sm\" onclick=\"switchToSingleNhap()\" style=\"width: auto; min-width: 140px;\">\n                            <span>üì•</span>\n                            <span>Nh·∫≠p L·∫ª</span>\n                        </button>\n                    </div>\n                    <p style=\"font-size: 13px; color: var(--text-secondary); margin-bottom: 16px;\">\n                        Nh·∫≠p nhi·ªÅu s·∫£n ph·∫©m c√πng l√∫c. M·ªói s·∫£n ph·∫©m s·∫Ω t·∫°o m·ªôt giao d·ªãch ri√™ng.\n                    </p>\n                    <div id=\"bulk-nhap-list\"></div>\n                    <div class=\"bulk-add-row\" onclick=\"addBulkNhapRow()\">\n                        <span>‚ûï Th√™m S·∫£n Ph·∫©m</span>\n                    </div>\n                    <div class=\"bulk-summary\">\n                        <span class=\"bulk-summary-label\">T·ªïng s·∫£n ph·∫©m:</span>\n                        <span class=\"bulk-summary-value\" id=\"bulk-nhap-count\">0</span>\n                    </div>\n                    <div class=\"form-group\">\n                        <label class=\"form-label\">Ghi Ch√∫ Chung</label>\n                        <input type=\"text\" class=\"form-control\" id=\"bulk-nhap-note\" placeholder=\"Ghi ch√∫ chung (kh√¥ng b·∫Øt bu·ªôc)\">\n                    </div>\n                    <button class=\"btn btn-success\" onclick=\"handleBulkNhap()\">\n                        <span>‚úÖ</span>\n                        <span>Nh·∫≠p T·∫•t C·∫£</span>\n                    </button>\n                </div>\n            </div>\n\n            <!-- Xuat Hang Bulk Section -->\n            <div class=\"section\" id=\"xuat-bulk\">\n                <div class=\"card\">\n                    <div class=\"card-title\">üìÆ Xu·∫•t Nhi·ªÅu S·∫£n Ph·∫©m</div>\n                    <div style=\"text-align: right; margin-bottom: 12px;\">\n                        <button type=\"button\" class=\"btn btn-secondary btn-sm\" onclick=\"switchToSingleXuat()\" style=\"width: auto; min-width: 140px;\">\n                            <span>üì§</span>\n                            <span>Xu·∫•t L·∫ª</span>\n                        </button>\n                    </div>\n                    <p style=\"font-size: 13px; color: var(--text-secondary); margin-bottom: 16px;\">\n                        Xu·∫•t nhi·ªÅu s·∫£n ph·∫©m c√πng l√∫c. H·ªá th·ªëng s·∫Ω ki·ªÉm tra t·ªìn kho cho t·ª´ng s·∫£n ph·∫©m.\n                    </p>\n                    <div id=\"bulk-xuat-list\"></div>\n                    <div class=\"bulk-add-row\" onclick=\"addBulkXuatRow()\">\n                        <span>‚ûï Th√™m S·∫£n Ph·∫©m</span>\n                    </div>\n                    <div class=\"bulk-summary\">\n                        <span class=\"bulk-summary-label\">T·ªïng s·∫£n ph·∫©m:</span>\n                        <span class=\"bulk-summary-value\" id=\"bulk-xuat-count\">0</span>\n                    </div>\n                    <div class=\"form-group\">\n                        <label class=\"form-label\">Ghi Ch√∫ Chung</label>\n                        <input type=\"text\" class=\"form-control\" id=\"bulk-xuat-note\" placeholder=\"Ghi ch√∫ chung (kh√¥ng b·∫Øt bu·ªôc)\">\n                    </div>\n                    <button class=\"btn btn-danger\" onclick=\"handleBulkXuat()\">\n                        <span>‚úÖ</span>\n                        <span>Xu·∫•t T·∫•t C·∫£</span>\n                    </button>\n                </div>\n            </div>\n\n            <!-- Ton Kho Section -->\n            <div class=\"section\" id=\"tonkho\">\n                <div class=\"card\">\n                    <div class=\"card-title\">üìã T·ªìn Kho Hi·ªán T·∫°i</div>\n                    <div style=\"display: flex; gap: 8px; margin-bottom: 16px; flex-wrap: wrap;\">\n                        <button class=\"btn btn-secondary btn-sm\" onclick=\"exportExcel()\" style=\"flex: 1; min-width: 140px;\">\n                            <span>üìä</span>\n                            <span>Xu·∫•t File Excel</span>\n                        </button>\n                        <button class=\"btn btn-primary btn-sm\" onclick=\"syncToGoogleSheet()\" style=\"flex: 1; min-width: 140px;\">\n                            <span>‚òÅÔ∏è</span>\n                            <span>ƒê·ªìng B·ªô GSheet</span>\n                        </button>\n                    </div>\n                    <div class=\"search-box\">\n                        <input type=\"text\" class=\"search-input\" id=\"search-tonkho\" placeholder=\"T√¨m ki·∫øm s·∫£n ph·∫©m...\">\n                        <span class=\"search-icon\">üîç</span>\n                    </div>\n                    <div id=\"tonkho-list\"></div>\n                </div>\n            </div>\n\n            <!-- Lich Su Section -->\n            <div class=\"section\" id=\"lichsu\">\n                <div class=\"card\">\n                    <div class=\"card-title\">üïê L·ªãch S·ª≠ Xu·∫•t Nh·∫≠p</div>\n                    <div class=\"search-box\">\n                        <input type=\"text\" class=\"search-input\" id=\"search-lichsu\" placeholder=\"T√¨m ki·∫øm...\">\n                        <span class=\"search-icon\">üîç</span>\n                    </div>\n                    <div class=\"form-group\">\n                        <select class=\"form-control\" id=\"filter-type\">\n                            <option value=\"\">T·∫•t c·∫£</option>\n                            <option value=\"nhap\">Nh·∫≠p v·ªÅ</option>\n                            <option value=\"xuat\">C·∫•p ph√°t</option>\n                        </select>\n                    </div>\n                    <div id=\"lichsu-list\"></div>\n                </div>\n            </div>\n\n            <!-- Danh Muc Section -->\n            <div class=\"section\" id=\"danhmuc\">\n                <div class=\"card\">\n                    <div class=\"card-title\">‚öôÔ∏è Qu·∫£n L√Ω Danh M·ª•c</div>\n                    <button class=\"btn btn-primary\" id=\"btn-add-product\" style=\"margin-bottom: 16px;\">\n                        <span>‚ûï</span>\n                        <span>Th√™m S·∫£n Ph·∫©m M·ªõi</span>\n                    </button>\n                    <div id=\"danhmuc-list\"></div>\n                </div>\n            </div>\n        </div>\n\n        <!-- Loading Overlay -->\n        <div class=\"loading\" id=\"loading\">\n            <div class=\"spinner\"></div>\n            <div>ƒêang x·ª≠ l√Ω...</div>\n        </div>\n\n        <!-- Toast -->\n        <div class=\"toast\" id=\"toast\">\n            <div class=\"toast-icon\" id=\"toast-icon\"></div>\n            <div class=\"toast-message\" id=\"toast-message\"></div>\n        </div>\n\n        <!-- Add/Edit Product Modal -->\n        <div class=\"modal\" id=\"modal-product\">\n            <div class=\"modal-content\">\n                <div class=\"modal-header\">\n                    <div class=\"modal-title\" id=\"modal-product-title\">Th√™m S·∫£n Ph·∫©m</div>\n                    <button class=\"modal-close\" onclick=\"closeModal('modal-product')\">√ó</button>\n                </div>\n                <form id=\"form-product\">\n                    <input type=\"hidden\" id=\"product-id\">\n                    <div class=\"form-group\">\n                        <label class=\"form-label\">T√™n S·∫£n Ph·∫©m</label>\n                        <input type=\"text\" class=\"form-control\" id=\"product-name\" required>\n                    </div>\n                    <div class=\"form-group\">\n                        <label class=\"form-label\">ƒê∆°n V·ªã</label>\n                        <input type=\"text\" class=\"form-control\" id=\"product-unit\" placeholder=\"VD: Th√πng, C√°i, Kg...\" required>\n                    </div>\n                    <div class=\"form-group\">\n                        <label class=\"form-label\">M√¥ T·∫£</label>\n                        <input type=\"text\" class=\"form-control\" id=\"product-description\" placeholder=\"M√¥ t·∫£ (kh√¥ng b·∫Øt bu·ªôc)\">\n                    </div>\n                    <button type=\"submit\" class=\"btn btn-primary\">\n                        <span>üíæ</span>\n                        <span>L∆∞u S·∫£n Ph·∫©m</span>\n                    </button>\n                </form>\n            </div>\n        </div>\n\n        <!-- Google Sheet Sync Modal -->\n        <div class=\"modal\" id=\"modal-gsheet-sync\">\n            <div class=\"modal-content\">\n                <div class=\"modal-header\">\n                    <div class=\"modal-title\">‚òÅÔ∏è ƒê·ªìng B·ªô Google Sheets</div>\n                    <button class=\"modal-close\" onclick=\"closeModal('modal-gsheet-sync')\">√ó</button>\n                </div>\n                \n                <!-- Sync Progress -->\n                <div id=\"sync-progress\" class=\"sync-progress\">\n                    <div class=\"sync-status\">\n                        <div class=\"sync-icon\" id=\"sync-icon\">‚òÅÔ∏è</div>\n                        <div class=\"sync-message\" id=\"sync-message\">ƒêang ƒë·ªìng b·ªô d·ªØ li·ªáu...</div>\n                    </div>\n                    <div class=\"sync-spinner\" id=\"sync-spinner\">\n                        <div class=\"spinner\"></div>\n                    </div>\n                </div>\n                \n                <!-- Sync Result -->\n                <div id=\"sync-result\" class=\"sync-result\" style=\"display: none;\">\n                    <div class=\"sync-success-icon\">‚úÖ</div>\n                    <h3 style=\"margin: 16px 0 8px 0; color: var(--success);\">ƒê·ªìng B·ªô Th√†nh C√¥ng!</h3>\n                    <p style=\"margin-bottom: 20px; color: var(--text-secondary); font-size: 14px;\">\n                        D·ªØ li·ªáu ƒë√£ ƒë∆∞·ª£c ƒë·ªìng b·ªô l√™n Google Sheets\n                    </p>\n                    \n                    <div class=\"gsheet-info\">\n                        <div style=\"font-size: 13px; color: var(--text-secondary); margin-bottom: 8px;\">\n                            üìä Sheets ƒë√£ t·∫°o:\n                        </div>\n                        <div style=\"font-size: 12px; color: var(--text-primary); line-height: 1.6;\">\n                            ‚Ä¢ RR88 - T·ªìn Kho<br>\n                            ‚Ä¢ XX88 - T·ªìn Kho<br>\n                            ‚Ä¢ MM88 - T·ªìn Kho<br>\n                            ‚Ä¢ L·ªãch S·ª≠ Xu·∫•t Nh·∫≠p (All)\n                        </div>\n                    </div>\n                    \n                    <div class=\"gsheet-link\">\n                        <input type=\"text\" class=\"form-control\" id=\"gsheet-url\" readonly style=\"font-size: 12px; margin-bottom: 12px;\">\n                        <div style=\"display: flex; gap: 8px;\">\n                            <button class=\"btn btn-secondary\" onclick=\"copyGSheetLink()\" style=\"flex: 1;\">\n                                <span>üìã</span>\n                                <span>Copy Link</span>\n                            </button>\n                            <button class=\"btn btn-primary\" onclick=\"openGSheet()\" style=\"flex: 1;\">\n                                <span>üîó</span>\n                                <span>M·ªü Google Sheet</span>\n                            </button>\n                        </div>\n                    </div>\n                </div>\n                \n                <!-- Sync Error -->\n                <div id=\"sync-error\" class=\"sync-error\" style=\"display: none;\">\n                    <div class=\"sync-error-icon\">‚ùå</div>\n                    <h3 style=\"margin: 16px 0 8px 0; color: var(--danger);\">ƒê·ªìng B·ªô Th·∫•t B·∫°i</h3>\n                    <p id=\"sync-error-message\" style=\"color: var(--text-secondary); font-size: 14px;\"></p>\n                    <button class=\"btn btn-secondary\" onclick=\"closeModal('modal-gsheet-sync')\" style=\"margin-top: 20px;\">\n                        <span>ƒê√≥ng</span>\n                    </button>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <script>\n        // Initialize\n        document.addEventListener('DOMContentLoaded', function() {\n            initializeApp();\n        });\n\n        async function initializeApp() {\n            try {\n                showLoading();\n                \n                // Step 1: Check permissions first\n                const authResult = await checkUserPermissions();\n                \n                if (!authResult.authorized) {\n                    handleUnauthorized(authResult.message);\n                    hideLoading();\n                    return;\n                }\n                \n                // Step 2: Setup allowed pages\n                allowedPages = authResult.pages || [];\n                \n                // Step 3: Set default page to first allowed page\n                if (allowedPages.length > 0) {\n                    currentPage = allowedPages[0];\n                }\n                \n                // Step 4: Update UI to show only allowed pages\n                updatePageButtons();\n                \n                // Step 5: Load data for allowed page\n                await loadProducts();\n                await loadTransactions();\n                await loadInventory();\n                \n                // Step 6: Setup listeners\n                setupEventListeners();\n                updateDashboard();\n                \n                hideLoading();\n                showToast('success', '·ª®ng d·ª•ng ƒë√£ s·∫µn s√†ng! üéâ');\n            } catch (error) {\n                hideLoading();\n                if (error.message !== 'Unauthorized') {\n                    showToast('error', 'L·ªói kh·ªüi t·∫°o: ' + error.message);\n                    logError('Initialize Error', error);\n                }\n            }\n        }\n        \n        async function checkUserPermissions() {\n            try {\n                const url = `${CONFIG.N8N_WEBHOOK_URL}/${CONFIG.API_PATH}?endpoint=check_auth&user_id=${currentUserId}`;\n                const response = await fetch(url);\n                \n                if (!response.ok) {\n                    return { authorized: false, message: 'Kh√¥ng th·ªÉ ki·ªÉm tra quy·ªÅn' };\n                }\n                \n                const result = await response.json();\n                \n                if (result.success && result.authorized) {\n                    // Parse pages string to array\n                    const pagesStr = result.pages || '';\n                    const pages = pagesStr.split(',').map(p => p.trim()).filter(p => p);\n                    \n                    return {\n                        authorized: true,\n                        pages: pages\n                    };\n                }\n                \n                return {\n                    authorized: false,\n                    message: result.message || 'Kh√¥ng c√≥ quy·ªÅn truy c·∫≠p'\n                };\n            } catch (error) {\n                console.error('[Auth] Check permission error:', error);\n                return {\n                    authorized: false,\n                    message: 'L·ªói ki·ªÉm tra quy·ªÅn'\n                };\n            }\n        }\n        \n        function updatePageButtons() {\n            const allPages = ['RR88', 'XX88', 'MM88'];\n            \n            allPages.forEach(page => {\n                const btn = document.querySelector(`.page-btn[data-page=\"${page}\"]`);\n                if (btn) {\n                    if (allowedPages.includes(page)) {\n                        // User c√≥ quy·ªÅn - show button\n                        btn.style.display = '';\n                        // Set active cho page ƒë·∫ßu ti√™n\n                        if (page === currentPage) {\n                            btn.classList.add('active');\n                        } else {\n                            btn.classList.remove('active');\n                        }\n                    } else {\n                        // User kh√¥ng c√≥ quy·ªÅn - hide button\n                        btn.style.display = 'none';\n                    }\n                }\n            });\n        }\n\n        function setupEventListeners() {\n            // Dashboard filters\n            document.querySelectorAll('.time-filter-btn').forEach(btn => {\n                btn.addEventListener('click', function() {\n                    document.querySelectorAll('.time-filter-btn').forEach(b => b.classList.remove('active'));\n                    this.classList.add('active');\n                    currentTimeFilter = this.dataset.filter;\n                    updateDashboard();\n                });\n            });\n            \n            document.querySelectorAll('.chart-toggle-btn').forEach(btn => {\n                btn.addEventListener('click', function() {\n                    document.querySelectorAll('.chart-toggle-btn').forEach(b => b.classList.remove('active'));\n                    this.classList.add('active');\n                    currentChartType = this.dataset.chart;\n                    updateChart();\n                });\n            });\n            \n            // Page selector\n            document.querySelectorAll('.page-btn').forEach(btn => {\n                btn.addEventListener('click', async function() {\n                    document.querySelectorAll('.page-btn').forEach(b => b.classList.remove('active'));\n                    this.classList.add('active');\n                    currentPage = this.dataset.page;\n                    try {\n                        showLoading();\n                        await loadProducts();\n                        await loadTransactions();\n                        await loadInventory();\n                        refreshCurrentSection();\n                        hideLoading();\n                    } catch (error) {\n                        hideLoading();\n                        showToast('error', 'L·ªói khi chuy·ªÉn page: ' + error.message);\n                    }\n                });\n            });\n\n            // Navigation\n            document.querySelectorAll('.nav-btn').forEach(btn => {\n                btn.addEventListener('click', function() {\n                    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));\n                    this.classList.add('active');\n                    showSection(this.dataset.section);\n                });\n            });\n\n            // Forms - v·ªõi null check\n            const formNhap = document.getElementById('form-nhap');\n            if (formNhap) {\n                formNhap.addEventListener('submit', handleNhapHang);\n            }\n            \n            const formXuat = document.getElementById('form-xuat');\n            if (formXuat) {\n                formXuat.addEventListener('submit', handleXuatHang);\n            }\n            \n            const formProduct = document.getElementById('form-product');\n            if (formProduct) {\n                formProduct.addEventListener('submit', handleSaveProduct);\n            }\n\n            // Search - v·ªõi null check\n            const searchTonKho = document.getElementById('search-tonkho');\n            if (searchTonKho) {\n                searchTonKho.addEventListener('input', debounce(filterTonKho, 300));\n            }\n            \n            const searchLichSu = document.getElementById('search-lichsu');\n            if (searchLichSu) {\n                searchLichSu.addEventListener('input', debounce(filterLichSu, 300));\n            }\n            \n            const filterType = document.getElementById('filter-type');\n            if (filterType) {\n                filterType.addEventListener('change', filterLichSu);\n            }\n\n            // Buttons\n            const btnAddProduct = document.getElementById('btn-add-product');\n            if (btnAddProduct) {\n                btnAddProduct.addEventListener('click', () => openProductModal());\n            }\n            \n            // Setup modal listeners\n            setupModalListeners();\n        }\n\n        function showSection(sectionId) {\n            currentSection = sectionId;\n            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));\n            document.getElementById(sectionId)?.classList.add('active');\n            \n            // Refresh section data\n            refreshCurrentSection();\n        }\n\n        function refreshCurrentSection() {\n            switch(currentSection) {\n                case 'dashboard':\n                    updateDashboard();\n                    break;\n                case 'nhap':\n                    updateProductSelects();\n                    break;\n                case 'nhap-bulk':\n                    renderBulkNhapList();\n                    break;\n                case 'xuat':\n                    updateProductSelects();\n                    break;\n                case 'xuat-bulk':\n                    renderBulkXuatList();\n                    break;\n                case 'tonkho':\n                    displayTonKho();\n                    break;\n                case 'lichsu':\n                    displayLichSu();\n                    break;\n                case 'danhmuc':\n                    displayDanhMuc();\n                    break;\n            }\n        }\n\n        // API Functions\n        async function apiCall(endpoint, method = 'GET', data = null) {\n            try {\n                const options = {\n                    method: method,\n                    headers: {\n                        'Content-Type': 'application/json',\n                    },\n                };\n\n                if (data) {\n                    options.body = JSON.stringify({\n                        ...data,\n                        page: currentPage,\n                        user: currentUser,\n                        timestamp: new Date().toISOString(),\n                    });\n                }\n\n                // Include user_id in URL for authentication\n                const url = `${CONFIG.N8N_WEBHOOK_URL}/${CONFIG.API_PATH}?endpoint=${endpoint}&page=${currentPage}&user_id=${currentUserId}`;\n                console.log('[API] Calling:', method, url);\n                \n                const response = await fetch(url, options);\n                \n                console.log('[API] Response status:', response.status);\n                console.log('[API] Response OK:', response.ok);\n                \n                if (!response.ok) {\n                    const errorText = await response.text();\n                    console.error('[API] Error response:', errorText);\n                    throw new Error(`HTTP error! status: ${response.status}`);\n                }\n                \n                // Get response text first\n                const responseText = await response.text();\n                console.log('[API] Response text:', responseText);\n                \n                // Try parse JSON\n                if (!responseText || responseText.trim() === '') {\n                    throw new Error('Empty response from server');\n                }\n                \n                let result;\n                try {\n                    result = JSON.parse(responseText);\n                    console.log('[API] Parsed result:', result);\n                } catch (parseError) {\n                    console.error('[API] JSON parse error:', parseError);\n                    console.error('[API] Invalid JSON:', responseText);\n                    throw new Error('Invalid JSON response from server');\n                }\n                \n                // Check for unauthorized\n                if (result.success === false && result.error === 'Unauthorized') {\n                    handleUnauthorized(result.message);\n                    throw new Error('Unauthorized');\n                }\n                \n                return result;\n            } catch (error) {\n                console.error('[API] Error:', error);\n                logError('API Call Error', error);\n                throw error;\n            }\n        }\n        \n        function handleUnauthorized(message) {\n            // Hide loading\n            hideLoading();\n            \n            // Show unauthorized message\n            const content = document.querySelector('.content');\n            if (content) {\n                content.innerHTML = `\n                    <div class=\"card\" style=\"text-align: center; padding: 40px;\">\n                        <div style=\"font-size: 64px; margin-bottom: 20px;\">üîí</div>\n                        <h2 style=\"margin-bottom: 16px;\">Kh√¥ng C√≥ Quy·ªÅn Truy C·∫≠p</h2>\n                        <p style=\"color: var(--text-secondary); margin-bottom: 24px;\">\n                            ${message || 'B·∫°n kh√¥ng c√≥ quy·ªÅn s·ª≠ d·ª•ng ·ª©ng d·ª•ng n√†y.'}\n                        </p>\n                        <p style=\"font-size: 14px; color: var(--text-secondary); margin-bottom: 24px;\">\n                            Telegram ID c·ªßa b·∫°n:<br>\n                            <strong style=\"font-size: 18px; color: var(--primary);\">${currentUserId || 'N/A'}</strong>\n                        </p>\n                        <a href=\"https://t.me/PinusITRR88\" class=\"btn btn-primary\" style=\"text-decoration: none; max-width: 300px; margin: 0 auto; display: inline-flex;\">\n                            <span>üí¨</span>\n                            <span>Li√™n H·ªá Admin ƒê·ªÉ ƒê∆∞·ª£c C·∫•p Quy·ªÅn</span>\n                        </a>\n                        <p style=\"margin-top: 16px; font-size: 13px; color: var(--text-secondary);\">\n                            G·ª≠i Telegram ID c·ªßa b·∫°n cho Admin @PinusITRR88\n                        </p>\n                    </div>\n                `;\n            }\n            \n            // Disable navigation\n            document.querySelectorAll('.nav-btn').forEach(btn => {\n                btn.disabled = true;\n                btn.style.opacity = '0.5';\n                btn.style.cursor = 'not-allowed';\n            });\n            \n            document.querySelectorAll('.page-btn').forEach(btn => {\n                btn.disabled = true;\n                btn.style.opacity = '0.5';\n                btn.style.cursor = 'not-allowed';\n            });\n        }\n\n\n        // Data Loading Functions\n        async function loadProducts() {\n            try {\n                const response = await apiCall('products', 'GET');\n                if (response.success) {\n                    products = response.data || [];\n                }\n            } catch (error) {\n                // If unauthorized, don't show error toast\n                if (error.message !== 'Unauthorized') {\n                    logError('Load Products Error', error);\n                    showToast('error', 'Kh√¥ng th·ªÉ t·∫£i danh s√°ch s·∫£n ph·∫©m');\n                }\n                throw error; // Stop initialization\n            }\n        }\n\n        async function loadTransactions() {\n            try {\n                const response = await apiCall('transactions', 'GET');\n                if (response.success) {\n                    transactions = response.data || [];\n                }\n            } catch (error) {\n                if (error.message !== 'Unauthorized') {\n                    logError('Load Transactions Error', error);\n                    showToast('error', 'Kh√¥ng th·ªÉ t·∫£i l·ªãch s·ª≠ xu·∫•t nh·∫≠p');\n                }\n                // Don't throw, continue loading\n            }\n        }\n\n        async function loadInventory() {\n            try {\n                const response = await apiCall('inventory', 'GET');\n                if (response.success) {\n                    if (!inventory[currentPage]) {\n                        inventory[currentPage] = {};\n                    }\n                    const data = response.data || [];\n                    data.forEach(item => {\n                        inventory[currentPage][item.product_id] = item.quantity;\n                    });\n                }\n            } catch (error) {\n                if (error.message !== 'Unauthorized') {\n                    logError('Load Inventory Error', error);\n                    showToast('error', 'Kh√¥ng th·ªÉ t·∫£i t·ªìn kho');\n                }\n                // Don't throw, continue\n            }\n        }\n\n        // Form Handlers\n        async function handleNhapHang(e) {\n            e.preventDefault();\n            \n            const productId = document.getElementById('nhap-product').value;\n            const quantity = document.getElementById('nhap-quantity').value;\n            const note = document.getElementById('nhap-note').value;\n\n            if (!productId || !quantity) {\n                showToast('error', 'Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin!');\n                return;\n            }\n\n            try {\n                showLoading();\n                \n                const response = await apiCall('transactions', 'POST', {\n                    type: 'nhap',\n                    product_id: parseInt(productId),\n                    quantity: parseInt(quantity),\n                    note: note,\n                });\n\n                if (response.success) {\n                    showToast('success', '‚úÖ Nh·∫≠p h√†ng th√†nh c√¥ng!');\n                    e.target.reset();\n                    await loadTransactions();\n                    await loadInventory();\n                    updateDashboard();\n                } else {\n                    throw new Error(response.message || 'L·ªói nh·∫≠p h√†ng');\n                }\n            } catch (error) {\n                showToast('error', 'L·ªói: ' + error.message);\n                logError('Nhap Hang Error', error);\n            } finally {\n                hideLoading();\n            }\n        }\n\n        async function handleXuatHang(e) {\n            e.preventDefault();\n            \n            const productId = document.getElementById('xuat-product').value;\n            const quantity = document.getElementById('xuat-quantity').value;\n            const note = document.getElementById('xuat-note').value;\n\n            if (!productId || !quantity) {\n                showToast('error', 'Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin!');\n                return;\n            }\n\n            // Check inventory\n            const currentInventory = inventory[currentPage]?.[productId] || 0;\n            if (currentInventory < parseInt(quantity)) {\n                showToast('error', `Kh√¥ng ƒë·ªß h√†ng! T·ªìn kho: ${currentInventory}`);\n                return;\n            }\n\n            try {\n                showLoading();\n                \n                const response = await apiCall('transactions', 'POST', {\n                    type: 'xuat',\n                    product_id: parseInt(productId),\n                    quantity: parseInt(quantity),\n                    note: note,\n                });\n\n                if (response.success) {\n                    showToast('success', '‚úÖ Xu·∫•t h√†ng th√†nh c√¥ng!');\n                    e.target.reset();\n                    await loadTransactions();\n                    await loadInventory();\n                    updateDashboard();\n                } else {\n                    throw new Error(response.message || 'L·ªói xu·∫•t h√†ng');\n                }\n            } catch (error) {\n                showToast('error', 'L·ªói: ' + error.message);\n                logError('Xuat Hang Error', error);\n            } finally {\n                hideLoading();\n            }\n        }\n\n        async function handleSaveProduct(e) {\n            e.preventDefault();\n            \n            const id = document.getElementById('product-id').value;\n            const name = document.getElementById('product-name').value;\n            const unit = document.getElementById('product-unit').value;\n            const description = document.getElementById('product-description').value;\n\n            try {\n                showLoading();\n                \n                const response = await apiCall('products', 'POST', {\n                    id: id && id.trim() !== '' ? parseInt(id) : null, // Only send ID if exists\n                    name: name,\n                    unit: unit,\n                    description: description,\n                    page: currentPage,\n                });\n\n                if (response.success) {\n                    showToast('success', id ? '‚úÖ C·∫≠p nh·∫≠t th√†nh c√¥ng!' : '‚úÖ Th√™m s·∫£n ph·∫©m th√†nh c√¥ng!');\n                    closeModal('modal-product');\n                    await loadProducts();\n                    displayDanhMuc();\n                    updateProductSelects();\n                } else {\n                    throw new Error(response.message || 'L·ªói l∆∞u s·∫£n ph·∫©m');\n                }\n            } catch (error) {\n                showToast('error', 'L·ªói: ' + error.message);\n                logError('Save Product Error', error);\n            } finally {\n                hideLoading();\n            }\n        }\n\n        // ===== DASHBOARD NEW FUNCTIONS =====\n        \n        // Time Range Functions\n        function getTimeRange(filter) {\n            const end = new Date();\n            let start;\n            \n            switch(filter) {\n                case 'day':\n                    start = new Date(end - 24 * 60 * 60 * 1000);\n                    break;\n                case 'week':\n                    start = new Date(end - 7 * 24 * 60 * 60 * 1000);\n                    break;\n                case 'month':\n                    start = new Date(end.getFullYear(), end.getMonth(), 1);\n                    break;\n                default:\n                    start = new Date(end - 7 * 24 * 60 * 60 * 1000);\n            }\n            \n            return { start, end };\n        }\n        \n        function formatDateRange(start, end) {\n            const options = { day: '2-digit', month: '2-digit', year: 'numeric' };\n            const startStr = start.toLocaleDateString('vi-VN', options);\n            const endStr = end.toLocaleDateString('vi-VN', options);\n            return `${startStr} ‚Üí ${endStr}`;\n        }\n        \n        // Filter transactions by time range\n        function filterTransactionsByTime(trans, start, end) {\n            return trans.filter(t => {\n                const tDate = new Date(t.timestamp);\n                return tDate >= start && tDate <= end;\n            });\n        }\n        \n        // Aggregate data by product\n        function aggregateByProduct(trans, pageProducts) {\n            const aggregated = [];\n            \n            pageProducts.forEach(product => {\n                const productTrans = trans.filter(t => t.product_id === product.id);\n                \n                const nhap = productTrans\n                    .filter(t => t.type === 'nhap')\n                    .reduce((sum, t) => sum + parseInt(t.quantity), 0);\n                    \n                const xuat = productTrans\n                    .filter(t => t.type === 'xuat')\n                    .reduce((sum, t) => sum + parseInt(t.quantity), 0);\n                \n                aggregated.push({\n                    id: product.id,\n                    name: product.name,\n                    unit: product.unit,\n                    nhap: nhap,\n                    xuat: xuat,\n                    net: nhap - xuat\n                });\n            });\n            \n            return aggregated;\n        }\n        \n        // Calculate trend compared to previous period\n        function calculateTrend(current, previous) {\n            if (previous === 0) {\n                return current > 0 ? 100 : 0;\n            }\n            return ((current - previous) / previous * 100).toFixed(1);\n        }\n        \n        // Get previous period transactions\n        function getPreviousPeriodData(filter) {\n            const { start, end } = getTimeRange(filter);\n            const duration = end - start;\n            \n            const prevEnd = new Date(start.getTime() - 1);\n            const prevStart = new Date(prevEnd - duration);\n            \n            const pageTrans = transactions.filter(t => t.page === currentPage);\n            return filterTransactionsByTime(pageTrans, prevStart, prevEnd);\n        }\n        \n        // Main Dashboard Update Function\n        function updateDashboard() {\n            try {\n                const { start, end } = getTimeRange(currentTimeFilter);\n                const pageTrans = transactions.filter(t => t.page === currentPage);\n                const pageProducts = products.filter(p => p.page === currentPage);\n                \n                // Filter transactions by time\n                const filteredTrans = filterTransactionsByTime(pageTrans, start, end);\n                const previousTrans = getPreviousPeriodData(currentTimeFilter);\n                \n                // Aggregate data\n                const productData = aggregateByProduct(filteredTrans, pageProducts);\n                \n                // Calculate totals\n                const totalNhap = productData.reduce((sum, p) => sum + p.nhap, 0);\n                const totalXuat = productData.reduce((sum, p) => sum + p.xuat, 0);\n                const totalNet = totalNhap - totalXuat;\n                \n                // Calculate previous totals for trend\n                const prevProductData = aggregateByProduct(previousTrans, pageProducts);\n                const prevNhap = prevProductData.reduce((sum, p) => sum + p.nhap, 0);\n                const prevXuat = prevProductData.reduce((sum, p) => sum + p.xuat, 0);\n                const prevNet = prevNhap - prevXuat;\n                \n                // Store for chart use\n                dashboardData = {\n                    products: productData,\n                    summary: {\n                        nhap: totalNhap,\n                        xuat: totalXuat,\n                        net: totalNet,\n                        trendNhap: calculateTrend(totalNhap, prevNhap),\n                        trendXuat: calculateTrend(totalXuat, prevXuat),\n                        trendNet: calculateTrend(totalNet, prevNet)\n                    }\n                };\n                \n                // Update UI\n                updateTimeRangeDisplay(start, end);\n                updateSummaryCards(dashboardData.summary);\n                updateChart();\n                updateDetailTable(productData);\n                \n            } catch (error) {\n                console.error('Update Dashboard Error:', error);\n                logError('Update Dashboard', error);\n            }\n        }\n        \n        // Update time range display\n        function updateTimeRangeDisplay(start, end) {\n            const el = document.getElementById('time-range-text');\n            if (el) {\n                el.textContent = formatDateRange(start, end);\n            }\n        }\n        \n        // Update summary cards with trends\n        function updateSummaryCards(summary) {\n            // Nh·∫≠p\n            const nhapValue = document.getElementById('summary-nhap');\n            const nhapTrend = document.getElementById('trend-nhap');\n            if (nhapValue) nhapValue.textContent = summary.nhap;\n            if (nhapTrend) {\n                updateTrendElement(nhapTrend, summary.trendNhap);\n            }\n            \n            // Xu·∫•t\n            const xuatValue = document.getElementById('summary-xuat');\n            const xuatTrend = document.getElementById('trend-xuat');\n            if (xuatValue) xuatValue.textContent = summary.xuat;\n            if (xuatTrend) {\n                updateTrendElement(xuatTrend, summary.trendXuat);\n            }\n            \n            // Net\n            const netValue = document.getElementById('summary-net');\n            const netTrend = document.getElementById('trend-net');\n            if (netValue) netValue.textContent = summary.net > 0 ? `+${summary.net}` : summary.net;\n            if (netTrend) {\n                updateTrendElement(netTrend, summary.trendNet);\n            }\n        }\n        \n        // Update trend element\n        function updateTrendElement(el, trendValue) {\n            const iconEl = el.querySelector('.trend-icon');\n            const textEl = el.querySelector('.trend-text');\n            \n            if (trendValue === null || trendValue === 0) {\n                el.className = 'summary-trend neutral';\n                if (iconEl) iconEl.textContent = '‚Äï';\n                if (textEl) textEl.textContent = 'N/A';\n            } else if (trendValue > 0) {\n                el.className = 'summary-trend up';\n                if (iconEl) iconEl.textContent = '‚Üë';\n                if (textEl) textEl.textContent = `${Math.abs(trendValue)}%`;\n            } else {\n                el.className = 'summary-trend down';\n                if (iconEl) iconEl.textContent = '‚Üì';\n                if (textEl) textEl.textContent = `${Math.abs(trendValue)}%`;\n            }\n        }\n        \n        // Update chart based on current type\n        function updateChart() {\n            if (!dashboardData || !dashboardData.products) return;\n            \n            if (currentChartType === 'bar') {\n                renderBarChart(dashboardData.products);\n            } else {\n                renderPieChart(dashboardData.products);\n            }\n        }\n        \n        // Render Bar Chart\n        function renderBarChart(productData) {\n            const canvas = document.getElementById('main-chart');\n            if (!canvas) return;\n            \n            const ctx = canvas.getContext('2d');\n            \n            // Destroy existing chart\n            if (chartInstance) {\n                chartInstance.destroy();\n            }\n            \n            // Prepare data\n            const labels = productData.map(p => p.name);\n            const nhapData = productData.map(p => p.nhap);\n            const xuatData = productData.map(p => p.xuat);\n            \n            // Get theme colors\n            const isDark = document.documentElement.getAttribute('data-theme') === 'dark';\n            const textColor = isDark ? '#EBEBF5' : '#000000';\n            const gridColor = isDark ? '#2C2C2E' : '#F2F2F7';\n            \n            chartInstance = new Chart(ctx, {\n                type: 'bar',\n                data: {\n                    labels: labels,\n                    datasets: [\n                        {\n                            label: 'üì• Nh·∫≠p',\n                            data: nhapData,\n                            backgroundColor: 'rgba(52, 199, 89, 0.8)',\n                            borderColor: 'rgba(52, 199, 89, 1)',\n                            borderWidth: 2,\n                            borderRadius: 8,\n                        },\n                        {\n                            label: 'üì§ Xu·∫•t',\n                            data: xuatData,\n                            backgroundColor: 'rgba(255, 59, 48, 0.8)',\n                            borderColor: 'rgba(255, 59, 48, 1)',\n                            borderWidth: 2,\n                            borderRadius: 8,\n                        }\n                    ]\n                },\n                options: {\n                    responsive: true,\n                    maintainAspectRatio: false,\n                    plugins: {\n                        legend: {\n                            position: 'bottom',\n                            labels: {\n                                usePointStyle: true,\n                                padding: 15,\n                                font: { size: 12 },\n                                color: textColor\n                            }\n                        },\n                        tooltip: {\n                            backgroundColor: 'rgba(0, 0, 0, 0.8)',\n                            padding: 12,\n                            titleFont: { size: 13 },\n                            bodyFont: { size: 12 },\n                            callbacks: {\n                                label: function(context) {\n                                    return `${context.dataset.label}: ${context.parsed.y}`;\n                                }\n                            }\n                        }\n                    },\n                    scales: {\n                        y: {\n                            beginAtZero: true,\n                            ticks: {\n                                color: textColor,\n                                font: { size: 11 }\n                            },\n                            grid: {\n                                color: gridColor\n                            }\n                        },\n                        x: {\n                            ticks: {\n                                color: textColor,\n                                font: { size: 10 },\n                                maxRotation: 45,\n                                minRotation: 45\n                            },\n                            grid: {\n                                display: false\n                            }\n                        }\n                    },\n                    animation: {\n                        duration: 750,\n                        easing: 'easeInOutQuart'\n                    }\n                }\n            });\n        }\n        \n        // Render Pie Chart\n        function renderPieChart(productData) {\n            const canvas = document.getElementById('main-chart');\n            if (!canvas) return;\n            \n            const ctx = canvas.getContext('2d');\n            \n            // Destroy existing chart\n            if (chartInstance) {\n                chartInstance.destroy();\n            }\n            \n            // Prepare data - combine nhap and xuat for all products\n            const labels = [];\n            const data = [];\n            const backgrounds = [];\n            \n            productData.forEach((p, index) => {\n                if (p.nhap > 0) {\n                    labels.push(`${p.name} (Nh·∫≠p)`);\n                    data.push(p.nhap);\n                    backgrounds.push(`rgba(52, 199, 89, ${0.9 - index * 0.05})`);\n                }\n                if (p.xuat > 0) {\n                    labels.push(`${p.name} (Xu·∫•t)`);\n                    data.push(p.xuat);\n                    backgrounds.push(`rgba(255, 59, 48, ${0.9 - index * 0.05})`);\n                }\n            });\n            \n            // Get theme\n            const isDark = document.documentElement.getAttribute('data-theme') === 'dark';\n            const textColor = isDark ? '#EBEBF5' : '#000000';\n            \n            chartInstance = new Chart(ctx, {\n                type: 'pie',\n                data: {\n                    labels: labels,\n                    datasets: [{\n                        data: data,\n                        backgroundColor: backgrounds,\n                        borderWidth: 2,\n                        borderColor: isDark ? '#1C1C1E' : '#FFFFFF'\n                    }]\n                },\n                options: {\n                    responsive: true,\n                    maintainAspectRatio: false,\n                    plugins: {\n                        legend: {\n                            position: 'bottom',\n                            labels: {\n                                usePointStyle: true,\n                                padding: 10,\n                                font: { size: 11 },\n                                color: textColor\n                            }\n                        },\n                        tooltip: {\n                            backgroundColor: 'rgba(0, 0, 0, 0.8)',\n                            padding: 12,\n                            titleFont: { size: 13 },\n                            bodyFont: { size: 12 },\n                            callbacks: {\n                                label: function(context) {\n                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);\n                                    const percentage = ((context.parsed / total) * 100).toFixed(1);\n                                    return `${context.label}: ${context.parsed} (${percentage}%)`;\n                                }\n                            }\n                        }\n                    },\n                    animation: {\n                        duration: 750,\n                        easing: 'easeInOutQuart'\n                    }\n                }\n            });\n        }\n        \n        // Update detail table\n        function updateDetailTable(productData) {\n            const container = document.getElementById('detail-table-container');\n            if (!container) return;\n            \n            if (productData.length === 0) {\n                container.innerHTML = '<div class=\"empty-state\"><div class=\"empty-state-icon\">üì¶</div><div class=\"empty-state-text\">Kh√¥ng c√≥ d·ªØ li·ªáu trong kho·∫£ng th·ªùi gian n√†y</div></div>';\n                return;\n            }\n            \n            // Sort by net (highest first)\n            const sorted = [...productData].sort((a, b) => Math.abs(b.net) - Math.abs(a.net));\n            \n            container.innerHTML = `\n                <table class=\"detail-table\">\n                    <thead>\n                        <tr>\n                            <th>S·∫£n Ph·∫©m</th>\n                            <th style=\"text-align: center;\">üì• Nh·∫≠p</th>\n                            <th style=\"text-align: center;\">üì§ Xu·∫•t</th>\n                            <th style=\"text-align: center;\">üì¶ Net</th>\n                        </tr>\n                    </thead>\n                    <tbody>\n                        ${sorted.map(item => `\n                            <tr>\n                                <td class=\"product-name\">${item.name}</td>\n                                <td class=\"quantity-nhap\" style=\"text-align: center;\">${item.nhap}</td>\n                                <td class=\"quantity-xuat\" style=\"text-align: center;\">${item.xuat}</td>\n                                <td class=\"quantity-net ${item.net > 0 ? 'positive' : item.net < 0 ? 'negative' : ''}\" style=\"text-align: center;\">\n                                    ${item.net > 0 ? '+' : ''}${item.net}\n                                </td>\n                            </tr>\n                        `).join('')}\n                    </tbody>\n                </table>\n            `;\n        }\n\n        function updateProductSelects() {\n            const pageProducts = products.filter(p => p.page === currentPage);\n            const pageInventory = inventory[currentPage] || {};\n            const nhapSelect = document.getElementById('nhap-product');\n            const xuatSelect = document.getElementById('xuat-product');\n\n            const options = pageProducts.map(p => {\n                const qty = pageInventory[p.id] || 0;\n                return `<option value=\"${p.id}\">${p.name} (TK: ${qty})</option>`;\n            }).join('');\n            \n            if (nhapSelect) nhapSelect.innerHTML = '<option value=\"\">-- Ch·ªçn s·∫£n ph·∫©m --</option>' + options;\n            if (xuatSelect) xuatSelect.innerHTML = '<option value=\"\">-- Ch·ªçn s·∫£n ph·∫©m --</option>' + options;\n        }\n\n        function displayTonKho() {\n            const container = document.getElementById('tonkho-list');\n            const pageProducts = products.filter(p => p.page === currentPage);\n            const pageInventory = inventory[currentPage] || {};\n\n            if (pageProducts.length === 0) {\n                container.innerHTML = '<div class=\"empty-state\"><div class=\"empty-state-icon\">üì¶</div><div class=\"empty-state-text\">Ch∆∞a c√≥ s·∫£n ph·∫©m n√†o</div></div>';\n                return;\n            }\n\n            container.innerHTML = `\n                <table class=\"inventory-table\">\n                    <thead>\n                        <tr>\n                            <th>S·∫£n Ph·∫©m</th>\n                            <th>ƒê∆°n V·ªã</th>\n                            <th>T·ªìn Kho</th>\n                        </tr>\n                    </thead>\n                    <tbody>\n                        ${pageProducts.map(product => {\n                            const qty = pageInventory[product.id] || 0;\n                            return `\n                                <tr>\n                                    <td><strong>${product.name}</strong></td>\n                                    <td>${product.unit}</td>\n                                    <td><strong style=\"color: ${qty > 0 ? 'var(--success)' : 'var(--danger)'};\">${qty}</strong></td>\n                                </tr>\n                            `;\n                        }).join('')}\n                    </tbody>\n                </table>\n            `;\n        }\n\n        function displayLichSu() {\n            const container = document.getElementById('lichsu-list');\n            const pageTransactions = transactions\n                .filter(t => t.page === currentPage)\n                .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));\n\n            if (pageTransactions.length === 0) {\n                container.innerHTML = '<div class=\"empty-state\"><div class=\"empty-state-icon\">üïê</div><div class=\"empty-state-text\">Ch∆∞a c√≥ l·ªãch s·ª≠ xu·∫•t nh·∫≠p</div></div>';\n                return;\n            }\n\n            // Group transactions by date\n            const groupedByDate = {};\n            pageTransactions.forEach(trans => {\n                const date = new Date(trans.timestamp);\n                const dateKey = date.toLocaleDateString('vi-VN', {\n                    year: 'numeric',\n                    month: '2-digit',\n                    day: '2-digit'\n                });\n                \n                if (!groupedByDate[dateKey]) {\n                    groupedByDate[dateKey] = {\n                        date: date,\n                        transactions: []\n                    };\n                }\n                groupedByDate[dateKey].transactions.push(trans);\n            });\n\n            // Generate HTML with date headers\n            let html = '';\n            Object.keys(groupedByDate).forEach(dateKey => {\n                const group = groupedByDate[dateKey];\n                const date = group.date;\n                \n                // Format date header\n                const today = new Date();\n                const yesterday = new Date(today);\n                yesterday.setDate(yesterday.getDate() - 1);\n                \n                let dateLabel;\n                if (date.toDateString() === today.toDateString()) {\n                    dateLabel = 'H√¥m Nay';\n                } else if (date.toDateString() === yesterday.toDateString()) {\n                    dateLabel = 'H√¥m Qua';\n                } else {\n                    const dayOfWeek = date.toLocaleDateString('vi-VN', { weekday: 'long' });\n                    dateLabel = `${dayOfWeek}, ${dateKey}`;\n                }\n                \n                html += `\n                    <div class=\"date-section\">\n                        <div class=\"date-header\">\n                            <span class=\"date-icon\">üìÖ</span>\n                            <span>${dateLabel}</span>\n                        </div>\n                        <div class=\"date-transactions\">\n                `;\n                \n                group.transactions.forEach(trans => {\n                    const product = products.find(p => p.id === trans.product_id);\n                    const productName = product ? product.name : 'N/A';\n                    const time = new Date(trans.timestamp).toLocaleTimeString('vi-VN', {\n                        hour: '2-digit',\n                        minute: '2-digit'\n                    });\n                    \n                    html += `\n                        <div class=\"list-item ${trans.type}\">\n                            <div class=\"list-item-header\">\n                                <div class=\"list-item-title\">${productName}</div>\n                                <div class=\"list-item-badge badge-${trans.type}\">\n                                    ${trans.type === 'nhap' ? 'üì• Nh·∫≠p v·ªÅ' : 'üì§ C·∫•p ph√°t'}\n                                </div>\n                            </div>\n                            <div class=\"list-item-details\">\n                                <div class=\"list-item-detail\">\n                                    <span>üìä</span>\n                                    <span>SL: ${trans.quantity}</span>\n                                </div>\n                                <div class=\"list-item-detail\">\n                                    <span>üïê</span>\n                                    <span>${time}</span>\n                                </div>\n                                ${trans.user ? `\n                                <div class=\"list-item-detail\">\n                                    <span>üë§</span>\n                                    <span>${trans.user}</span>\n                                </div>\n                                ` : ''}\n                            </div>\n                            ${trans.note ? `<div style=\"margin-top: 8px; font-size: 13px; color: var(--text-secondary);\">üìù ${trans.note}</div>` : ''}\n                        </div>\n                    `;\n                });\n                \n                html += `\n                        </div>\n                    </div>\n                `;\n            });\n\n            container.innerHTML = html;\n        }\n\n        function displayDanhMuc() {\n            const container = document.getElementById('danhmuc-list');\n            const pageProducts = products.filter(p => p.page === currentPage);\n\n            if (pageProducts.length === 0) {\n                container.innerHTML = '<div class=\"empty-state\"><div class=\"empty-state-icon\">üì¶</div><div class=\"empty-state-text\">Ch∆∞a c√≥ s·∫£n ph·∫©m n√†o</div></div>';\n                return;\n            }\n\n            container.innerHTML = pageProducts.map(product => `\n                <div class=\"list-item\">\n                    <div class=\"list-item-header\">\n                        <div class=\"list-item-title\">${product.name}</div>\n                        <div class=\"action-btns\">\n                            <button class=\"btn btn-secondary btn-sm\" onclick=\"editProduct(${product.id})\">‚úèÔ∏è S·ª≠a</button>\n                        </div>\n                    </div>\n                    <div class=\"list-item-details\">\n                        <div class=\"list-item-detail\">\n                            <span>üìè</span>\n                            <span>ƒê∆°n v·ªã: ${product.unit}</span>\n                        </div>\n                        ${product.description ? `\n                        <div class=\"list-item-detail\">\n                            <span>üìù</span>\n                            <span>${product.description}</span>\n                        </div>\n                        ` : ''}\n                    </div>\n                </div>\n            `).join('');\n        }\n\n        // Filter Functions\n        function filterTonKho() {\n            const searchTerm = document.getElementById('search-tonkho').value.toLowerCase();\n            const pageProducts = products.filter(p =>\n                p.page === currentPage && p.name.toLowerCase().includes(searchTerm)\n            );\n            \n            const container = document.getElementById('tonkho-list');\n            const pageInventory = inventory[currentPage] || {};\n\n            if (pageProducts.length === 0) {\n                container.innerHTML = '<div class=\"empty-state\"><div class=\"empty-state-icon\">üîç</div><div class=\"empty-state-text\">Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m</div></div>';\n                return;\n            }\n\n            container.innerHTML = `\n                <table class=\"inventory-table\">\n                    <thead>\n                        <tr>\n                            <th>S·∫£n Ph·∫©m</th>\n                            <th>ƒê∆°n V·ªã</th>\n                            <th>T·ªìn Kho</th>\n                        </tr>\n                    </thead>\n                    <tbody>\n                        ${pageProducts.map(product => {\n                            const qty = pageInventory[product.id] || 0;\n                            return `\n                                <tr>\n                                    <td><strong>${product.name}</strong></td>\n                                    <td>${product.unit}</td>\n                                    <td><strong style=\"color: ${qty > 0 ? 'var(--success)' : 'var(--danger)'};\">${qty}</strong></td>\n                                </tr>\n                            `;\n                        }).join('')}\n                    </tbody>\n                </table>\n            `;\n        }\n\n        function filterLichSu() {\n            const searchTerm = document.getElementById('search-lichsu').value.toLowerCase();\n            const filterType = document.getElementById('filter-type').value;\n            \n            let filtered = transactions.filter(t => t.page === currentPage);\n            \n            if (filterType) {\n                filtered = filtered.filter(t => t.type === filterType);\n            }\n            \n            if (searchTerm) {\n                filtered = filtered.filter(t => {\n                    const product = products.find(p => p.id === t.product_id);\n                    return product && product.name.toLowerCase().includes(searchTerm);\n                });\n            }\n\n            filtered.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));\n\n            const container = document.getElementById('lichsu-list');\n\n            if (filtered.length === 0) {\n                container.innerHTML = '<div class=\"empty-state\"><div class=\"empty-state-icon\">üîç</div><div class=\"empty-state-text\">Kh√¥ng t√¨m th·∫•y</div></div>';\n                return;\n            }\n\n            // Group by date\n            const groupedByDate = {};\n            filtered.forEach(trans => {\n                const date = new Date(trans.timestamp);\n                const dateKey = date.toLocaleDateString('vi-VN', {\n                    year: 'numeric',\n                    month: '2-digit',\n                    day: '2-digit'\n                });\n                \n                if (!groupedByDate[dateKey]) {\n                    groupedByDate[dateKey] = {\n                        date: date,\n                        transactions: []\n                    };\n                }\n                groupedByDate[dateKey].transactions.push(trans);\n            });\n\n            // Generate HTML with date headers\n            let html = '';\n            Object.keys(groupedByDate).forEach(dateKey => {\n                const group = groupedByDate[dateKey];\n                const date = group.date;\n                \n                // Format date header\n                const today = new Date();\n                const yesterday = new Date(today);\n                yesterday.setDate(yesterday.getDate() - 1);\n                \n                let dateLabel;\n                if (date.toDateString() === today.toDateString()) {\n                    dateLabel = 'H√¥m Nay';\n                } else if (date.toDateString() === yesterday.toDateString()) {\n                    dateLabel = 'H√¥m Qua';\n                } else {\n                    const dayOfWeek = date.toLocaleDateString('vi-VN', { weekday: 'long' });\n                    dateLabel = `${dayOfWeek}, ${dateKey}`;\n                }\n                \n                html += `\n                    <div class=\"date-section\">\n                        <div class=\"date-header\">\n                            <span class=\"date-icon\">üìÖ</span>\n                            <span>${dateLabel}</span>\n                        </div>\n                        <div class=\"date-transactions\">\n                `;\n                \n                group.transactions.forEach(trans => {\n                    const product = products.find(p => p.id === trans.product_id);\n                    const productName = product ? product.name : 'N/A';\n                    const time = new Date(trans.timestamp).toLocaleTimeString('vi-VN', {\n                        hour: '2-digit',\n                        minute: '2-digit'\n                    });\n                    \n                    html += `\n                        <div class=\"list-item ${trans.type}\">\n                            <div class=\"list-item-header\">\n                                <div class=\"list-item-title\">${productName}</div>\n                                <div class=\"list-item-badge badge-${trans.type}\">\n                                    ${trans.type === 'nhap' ? 'üì• Nh·∫≠p v·ªÅ' : 'üì§ C·∫•p ph√°t'}\n                                </div>\n                            </div>\n                            <div class=\"list-item-details\">\n                                <div class=\"list-item-detail\">\n                                    <span>üìä</span>\n                                    <span>SL: ${trans.quantity}</span>\n                                </div>\n                                <div class=\"list-item-detail\">\n                                    <span>üïê</span>\n                                    <span>${time}</span>\n                                </div>\n                            </div>\n                            ${trans.note ? `<div style=\"margin-top: 8px; font-size: 13px; color: var(--text-secondary);\">üìù ${trans.note}</div>` : ''}\n                        </div>\n                    `;\n                });\n                \n                html += `\n                        </div>\n                    </div>\n                `;\n            });\n\n            container.innerHTML = html;\n        }\n\n        // Export to Excel/CSV Function\n        function exportExcel() {\n            try {\n                // Check if on mobile\n                const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);\n                \n                if (isMobile) {\n                    // Mobile: Export as CSV (works better on mobile)\n                    exportCSV();\n                } else {\n                    // Desktop: Export as Excel\n                    exportExcelFile();\n                }\n            } catch (error) {\n                showToast('error', 'L·ªói export: ' + error.message);\n                logError('Export Error', error);\n            }\n        }\n        \n        function exportExcelFile() {\n            // Prepare Sheet 1 - T·ªìn Kho\n            const pageInventory = inventory[currentPage] || {};\n            const tonkhoData = [['S·∫£n Ph·∫©m', 'ƒê∆°n V·ªã', 'T·ªìn Kho', 'Page']];\n            \n            products.forEach(product => {\n                if (product.page === currentPage) {\n                    const qty = pageInventory[product.id] || 0;\n                    tonkhoData.push([product.name, product.unit, qty, product.page]);\n                }\n            });\n            \n            // Prepare Sheet 2 - L·ªãch S·ª≠\n            const lichsuData = [['Ng√†y Gi·ªù', 'Lo·∫°i', 'S·∫£n Ph·∫©m', 'S·ªë L∆∞·ª£ng', 'Ng∆∞·ªùi', 'Ghi Ch√∫', 'Page']];\n            \n            const pageTransactions = transactions\n                .filter(t => t.page === currentPage)\n                .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));\n                \n            pageTransactions.forEach(trans => {\n                const product = products.find(p => p.id === trans.product_id);\n                const time = new Date(trans.timestamp).toLocaleString('vi-VN');\n                const type = trans.type === 'nhap' ? 'Nh·∫≠p v·ªÅ' : 'C·∫•p ph√°t';\n                \n                lichsuData.push([\n                    time,\n                    type,\n                    product ? product.name : 'N/A',\n                    trans.quantity,\n                    trans.user || 'N/A',\n                    trans.note || '',\n                    trans.page\n                ]);\n            });\n            \n            // Create workbook\n            const wb = XLSX.utils.book_new();\n            const ws1 = XLSX.utils.aoa_to_sheet(tonkhoData);\n            const ws2 = XLSX.utils.aoa_to_sheet(lichsuData);\n            \n            ws1['!cols'] = [{ wch: 30 }, { wch: 15 }, { wch: 12 }, { wch: 10 }];\n            ws2['!cols'] = [{ wch: 20 }, { wch: 12 }, { wch: 30 }, { wch: 12 }, { wch: 20 }, { wch: 40 }, { wch: 10 }];\n            \n            XLSX.utils.book_append_sheet(wb, ws1, 'T·ªìn Kho');\n            XLSX.utils.book_append_sheet(wb, ws2, 'L·ªãch S·ª≠');\n            \n            const now = new Date();\n            const filename = `XuatNhapHang_${currentPage}_${now.getFullYear()}${(now.getMonth()+1).toString().padStart(2,'0')}${now.getDate().toString().padStart(2,'0')}.xlsx`;\n            \n            XLSX.writeFile(wb, filename);\n            showToast('success', 'ƒê√£ export Excel th√†nh c√¥ng!');\n        }\n        \n        function exportCSV() {\n            let csv = 'T·ªíN KHO\\n';\n            csv += 'S·∫£n Ph·∫©m,ƒê∆°n V·ªã,T·ªìn Kho,Page\\n';\n            \n            const pageInventory = inventory[currentPage] || {};\n            products.forEach(product => {\n                if (product.page === currentPage) {\n                    const qty = pageInventory[product.id] || 0;\n                    csv += `${product.name},${product.unit},${qty},${product.page}\\n`;\n                }\n            });\n            \n            csv += '\\nL·ªäCH S·ª¨ XU·∫§T NH·∫¨P\\n';\n            csv += 'Ng√†y Gi·ªù,Lo·∫°i,S·∫£n Ph·∫©m,S·ªë L∆∞·ª£ng,Ng∆∞·ªùi,Ghi Ch√∫,Page\\n';\n            \n            const pageTransactions = transactions\n                .filter(t => t.page === currentPage)\n                .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));\n                \n            pageTransactions.forEach(trans => {\n                const product = products.find(p => p.id === trans.product_id);\n                const time = new Date(trans.timestamp).toLocaleString('vi-VN');\n                const type = trans.type === 'nhap' ? 'Nh·∫≠p v·ªÅ' : 'C·∫•p ph√°t';\n                \n                csv += `${time},${type},${product ? product.name : 'N/A'},${trans.quantity},${trans.user || 'N/A'},\"${trans.note || ''}\",${trans.page}\\n`;\n            });\n            \n            // Create and download\n            const blob = new Blob(['\\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });\n            const link = document.createElement('a');\n            const url = URL.createObjectURL(blob);\n            \n            const now = new Date();\n            const filename = `XuatNhapHang_${currentPage}_${now.getFullYear()}${(now.getMonth()+1).toString().padStart(2,'0')}${now.getDate().toString().padStart(2,'0')}.csv`;\n            \n            link.href = url;\n            link.download = filename;\n            link.style.display = 'none';\n            document.body.appendChild(link);\n            link.click();\n            document.body.removeChild(link);\n            URL.revokeObjectURL(url);\n            \n            showToast('success', 'ƒê√£ export CSV th√†nh c√¥ng!');\n        }\n\n        // Modal Functions\n        function openProductModal(productId = null) {\n            const modal = document.getElementById('modal-product');\n            const title = document.getElementById('modal-product-title');\n            const form = document.getElementById('form-product');\n            \n            // Reset form COMPLETELY\n            form.reset();\n            document.getElementById('product-id').value = ''; // Clear hidden ID field\n            \n            if (productId) {\n                // Edit mode - c√≥ ID\n                const product = products.find(p => p.id === productId);\n                if (product) {\n                    title.textContent = 'S·ª≠a S·∫£n Ph·∫©m';\n                    document.getElementById('product-id').value = product.id;\n                    document.getElementById('product-name').value = product.name;\n                    document.getElementById('product-unit').value = product.unit;\n                    document.getElementById('product-description').value = product.description || '';\n                }\n            } else {\n                // Add mode - KH√îNG ID\n                title.textContent = 'Th√™m S·∫£n Ph·∫©m';\n                document.getElementById('product-id').value = ''; // Ensure empty\n            }\n            \n            modal.classList.add('active');\n        }\n\n        function closeModal(modalId) {\n            const modal = document.getElementById(modalId);\n            modal.classList.remove('active');\n            \n            // Reset form khi ƒë√≥ng ƒë·ªÉ clear ID c≈©\n            if (modalId === 'modal-product') {\n                const form = document.getElementById('form-product');\n                if (form) {\n                    form.reset();\n                    document.getElementById('product-id').value = ''; // Clear ID\n                }\n            }\n        }\n\n        function editProduct(productId) {\n            openProductModal(productId);\n        }\n\n        // UI Helper Functions\n        function showLoading() {\n            document.getElementById('loading').classList.add('active');\n        }\n\n        function hideLoading() {\n            document.getElementById('loading').classList.remove('active');\n        }\n\n        function showToast(type, message) {\n            const toast = document.getElementById('toast');\n            const icon = document.getElementById('toast-icon');\n            const messageEl = document.getElementById('toast-message');\n            \n            toast.className = 'toast show toast-' + type;\n            \n            // Set icon\n            switch(type) {\n                case 'success':\n                    icon.textContent = '‚úÖ';\n                    break;\n                case 'error':\n                    icon.textContent = '‚ùå';\n                    break;\n                case 'info':\n                    icon.textContent = '‚ÑπÔ∏è';\n                    break;\n            }\n            \n            // Clean message - remove duplicate emoji\n            const cleanMessage = message.replace(/^[‚úÖ‚ùå‚ÑπÔ∏è]\\s*/, '');\n            messageEl.textContent = cleanMessage;\n            \n            setTimeout(() => {\n                toast.classList.remove('show');\n            }, 3000);\n        }\n\n        function debounce(func, wait) {\n            let timeout;\n            return function executedFunction(...args) {\n                const later = () => {\n                    clearTimeout(timeout);\n                    func(...args);\n                };\n                clearTimeout(timeout);\n                timeout = setTimeout(later, wait);\n            };\n        }\n\n        // Error Logging\n        function logError(context, error) {\n            const errorLog = {\n                context: context,\n                message: error.message,\n                stack: error.stack,\n                timestamp: new Date().toISOString(),\n                page: currentPage,\n                user: tg?.initDataUnsafe?.user?.username || 'demo_user',\n            };\n            \n            console.error('Error Log:', errorLog);\n            \n            // Send to n8n for logging\n            fetch(`${CONFIG.N8N_WEBHOOK_URL}?endpoint=log`, {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify(errorLog),\n            }).catch(() => {}); // Silent fail for logging\n        }\n\n        // Setup modal listeners (called after DOM ready and authorized)\n        function setupModalListeners() {\n            document.querySelectorAll('.modal').forEach(modal => {\n                modal.addEventListener('click', function(e) {\n                    if (e.target === this) {\n                        this.classList.remove('active');\n                    }\n                });\n            });\n        }\n        \n        // ===== GOOGLE SHEET SYNC FUNCTIONS =====\n        \n        async function syncToGoogleSheet() {\n            const modal = document.getElementById('modal-gsheet-sync');\n            const progressDiv = document.getElementById('sync-progress');\n            const resultDiv = document.getElementById('sync-result');\n            const errorDiv = document.getElementById('sync-error');\n            \n            // Show modal with progress\n            modal.classList.add('active');\n            progressDiv.style.display = 'block';\n            resultDiv.style.display = 'none';\n            errorDiv.style.display = 'none';\n            \n            // Save current page\n            const originalPage = currentPage;\n            \n            try {\n                // Update sync message\n                document.getElementById('sync-message').textContent = 'ƒêang t·∫£i d·ªØ li·ªáu c·∫£ 3 trang...';\n                \n                // Load data for ALL 3 pages\n                const allPages = ['RR88', 'XX88', 'MM88'];\n                const allProductsData = [];\n                const allTransactionsData = [];\n                \n                for (let i = 0; i < allPages.length; i++) {\n                    const page = allPages[i];\n                    \n                    // Update progress\n                    document.getElementById('sync-message').textContent = `ƒêang t·∫£i ${page}... (${i+1}/3)`;\n                    \n                    // Temporarily switch to this page\n                    currentPage = page;\n                    \n                    // Load products for this page\n                    const productsResponse = await apiCall('products', 'GET');\n                    if (productsResponse.success) {\n                        allProductsData.push(...(productsResponse.data || []));\n                    }\n                    \n                    // Load transactions for this page\n                    const transactionsResponse = await apiCall('transactions', 'GET');\n                    if (transactionsResponse.success) {\n                        allTransactionsData.push(...(transactionsResponse.data || []));\n                    }\n                    \n                    // Load/calculate inventory for this page\n                    const inventoryResponse = await apiCall('inventory', 'GET');\n                    if (inventoryResponse.success) {\n                        if (!inventory[page]) {\n                            inventory[page] = {};\n                        }\n                        const data = inventoryResponse.data || [];\n                        data.forEach(item => {\n                            inventory[page][item.product_id] = item.quantity;\n                        });\n                    }\n                }\n                \n                // Restore original page\n                currentPage = originalPage;\n                \n                // Update global data v·ªõi full data\n                const originalProducts = products;\n                const originalTransactions = transactions;\n                \n                products = allProductsData;\n                transactions = allTransactionsData;\n                \n                // Update sync message\n                document.getElementById('sync-message').textContent = 'ƒêang ƒë·ªìng b·ªô l√™n Google Sheets...';\n                \n                // Prepare data for all 3 pages\n                const syncData = prepareSyncData();\n                \n                console.log('[GSheet Sync] Sending data:', syncData);\n                \n                // Call n8n workflow\n                const response = await apiCall('sync_gsheet', 'POST', syncData);\n                \n                console.log('[GSheet Sync] Response:', response);\n                \n                if (response.success && response.spreadsheetUrl) {\n                    // Show success result\n                    progressDiv.style.display = 'none';\n                    resultDiv.style.display = 'block';\n                    \n                    // Set Google Sheet URL\n                    document.getElementById('gsheet-url').value = response.spreadsheetUrl;\n                    \n                    showToast('success', 'ƒê·ªìng b·ªô Google Sheets th√†nh c√¥ng!');\n                } else {\n                    throw new Error(response.message || 'Kh√¥ng nh·∫≠n ƒë∆∞·ª£c URL t·ª´ server');\n                }\n            } catch (error) {\n                // Restore original page on error\n                currentPage = originalPage;\n                \n                // Show error\n                progressDiv.style.display = 'none';\n                errorDiv.style.display = 'block';\n                \n                const errorMsg = document.getElementById('sync-error-message');\n                errorMsg.textContent = error.message || 'ƒê√£ x·∫£y ra l·ªói khi ƒë·ªìng b·ªô';\n                \n                showToast('error', 'L·ªói ƒë·ªìng b·ªô: ' + error.message);\n                logError('Google Sheet Sync Error', error);\n            }\n        }\n        \n        function prepareSyncData() {\n            // Chu·∫©n b·ªã data cho c·∫£ 3 pages\n            const allPages = ['RR88', 'XX88', 'MM88'];\n            const inventoryData = {};\n            \n            // Get inventory for each page\n            allPages.forEach(page => {\n                const pageProducts = products.filter(p => p.page === page);\n                const pageInventory = inventory[page] || {};\n                \n                inventoryData[page] = pageProducts.map(product => ({\n                    id: product.id,\n                    name: product.name,\n                    unit: product.unit,\n                    quantity: pageInventory[product.id] || 0,\n                    description: product.description || ''\n                }));\n            });\n            \n            // Get all transactions (all pages)\n            const allTransactions = transactions\n                .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))\n                .map(trans => {\n                    const product = products.find(p => p.id === trans.product_id);\n                    return {\n                        id: trans.id,\n                        timestamp: new Date(trans.timestamp).toLocaleString('vi-VN'),\n                        page: trans.page,\n                        type: trans.type === 'nhap' ? 'Nh·∫≠p v·ªÅ' : 'C·∫•p ph√°t',\n                        product_id: trans.product_id,\n                        product: product ? product.name : 'N/A',\n                        quantity: trans.quantity,\n                        user: trans.user || 'N/A',\n                        note: trans.note || ''\n                    };\n                });\n            \n            return {\n                inventory: inventoryData,\n                transactions: allTransactions,\n                sync_time: new Date().toISOString(),\n                synced_by: currentUser\n            };\n        }\n        \n        function copyGSheetLink() {\n            const input = document.getElementById('gsheet-url');\n            if (input) {\n                input.select();\n                input.setSelectionRange(0, 99999); // Mobile\n                \n                try {\n                    document.execCommand('copy');\n                    showToast('success', 'ƒê√£ copy link!');\n                } catch (err) {\n                    // Fallback for modern browsers\n                    navigator.clipboard.writeText(input.value).then(() => {\n                        showToast('success', 'ƒê√£ copy link!');\n                    }).catch(() => {\n                        showToast('error', 'Kh√¥ng th·ªÉ copy link');\n                    });\n                }\n            }\n        }\n        \n        function openGSheet() {\n            const url = document.getElementById('gsheet-url').value;\n            if (url) {\n                // Use Telegram WebApp openLink if available\n                if (tg && tg.openLink) {\n                    tg.openLink(url);\n                } else {\n                    // Fallback to window.open\n                    window.open(url, '_blank');\n                }\n            }\n        }\n        \n        // ===== BULK IMPORT/EXPORT FUNCTIONS =====\n        \n        let bulkNhapItems = [];\n        let bulkXuatItems = [];\n        \n        function addBulkNhapRow() {\n            const pageProducts = products.filter(p => p.page === currentPage);\n            if (pageProducts.length === 0) {\n                showToast('error', 'Ch∆∞a c√≥ s·∫£n ph·∫©m n√†o!');\n                return;\n            }\n            \n            const id = Date.now();\n            bulkNhapItems.push({\n                id: id,\n                product_id: null,\n                quantity: 1\n            });\n            \n            renderBulkNhapList();\n        }\n        \n        function addBulkXuatRow() {\n            const pageProducts = products.filter(p => p.page === currentPage);\n            if (pageProducts.length === 0) {\n                showToast('error', 'Ch∆∞a c√≥ s·∫£n ph·∫©m n√†o!');\n                return;\n            }\n            \n            const id = Date.now();\n            bulkXuatItems.push({\n                id: id,\n                product_id: null,\n                quantity: 1\n            });\n            \n            renderBulkXuatList();\n        }\n        \n        function removeBulkNhapItem(id) {\n            bulkNhapItems = bulkNhapItems.filter(item => item.id !== id);\n            renderBulkNhapList();\n        }\n        \n        function removeBulkXuatItem(id) {\n            bulkXuatItems = bulkXuatItems.filter(item => item.id !== id);\n            renderBulkXuatList();\n        }\n        \n        function updateBulkNhapItem(id, field, value) {\n            const item = bulkNhapItems.find(i => i.id === id);\n            if (item) {\n                item[field] = field === 'product_id' ? parseInt(value) : parseInt(value);\n            }\n            renderBulkNhapList();\n        }\n        \n        function updateBulkXuatItem(id, field, value) {\n            const item = bulkXuatItems.find(i => i.id === id);\n            if (item) {\n                item[field] = field === 'product_id' ? parseInt(value) : parseInt(value);\n            }\n            renderBulkXuatList();\n        }\n        \n        function renderBulkNhapList() {\n            const container = document.getElementById('bulk-nhap-list');\n            const pageProducts = products.filter(p => p.page === currentPage);\n            \n            if (bulkNhapItems.length === 0) {\n                container.innerHTML = '<div class=\"empty-state\" style=\"padding: 20px;\"><div class=\"empty-state-text\" style=\"font-size: 14px;\">Ch∆∞a c√≥ s·∫£n ph·∫©m n√†o. Click \"Th√™m S·∫£n Ph·∫©m\" ƒë·ªÉ b·∫Øt ƒë·∫ßu.</div></div>';\n                document.getElementById('bulk-nhap-count').textContent = '0';\n                return;\n            }\n            \n            container.innerHTML = bulkNhapItems.map(item => `\n                <div class=\"bulk-item\">\n                    <select class=\"form-control\" onchange=\"updateBulkNhapItem(${item.id}, 'product_id', this.value)\" style=\"font-size: 14px; padding: 8px 12px; min-height: 36px;\">\n                        <option value=\"\">-- Ch·ªçn s·∫£n ph·∫©m --</option>\n                        ${pageProducts.map(p => `<option value=\"${p.id}\" ${item.product_id === p.id ? 'selected' : ''}>${p.name}</option>`).join('')}\n                    </select>\n                    <div class=\"bulk-item-quantity\">\n                        <span style=\"font-size: 13px; color: var(--text-secondary);\">SL:</span>\n                        <input type=\"number\" class=\"bulk-qty-input\" value=\"${item.quantity}\" min=\"1\" onchange=\"updateBulkNhapItem(${item.id}, 'quantity', this.value)\">\n                    </div>\n                    <button class=\"bulk-remove-btn\" onclick=\"removeBulkNhapItem(${item.id})\">üóëÔ∏è</button>\n                </div>\n            `).join('');\n            \n            document.getElementById('bulk-nhap-count').textContent = bulkNhapItems.length;\n        }\n        \n        function renderBulkXuatList() {\n            const container = document.getElementById('bulk-xuat-list');\n            const pageProducts = products.filter(p => p.page === currentPage);\n            const pageInventory = inventory[currentPage] || {};\n            \n            if (bulkXuatItems.length === 0) {\n                container.innerHTML = '<div class=\"empty-state\" style=\"padding: 20px;\"><div class=\"empty-state-text\" style=\"font-size: 14px;\">Ch∆∞a c√≥ s·∫£n ph·∫©m n√†o. Click \"Th√™m S·∫£n Ph·∫©m\" ƒë·ªÉ b·∫Øt ƒë·∫ßu.</div></div>';\n                document.getElementById('bulk-xuat-count').textContent = '0';\n                return;\n            }\n            \n            container.innerHTML = bulkXuatItems.map(item => {\n                const currentInv = item.product_id ? (pageInventory[item.product_id] || 0) : 0;\n                return `\n                    <div class=\"bulk-item\">\n                        <select class=\"form-control\" onchange=\"updateBulkXuatItem(${item.id}, 'product_id', this.value)\" style=\"font-size: 14px; padding: 8px 12px; min-height: 36px;\">\n                            <option value=\"\">-- Ch·ªçn s·∫£n ph·∫©m --</option>\n                            ${pageProducts.map(p => {\n                                const inv = pageInventory[p.id] || 0;\n                                return `<option value=\"${p.id}\" ${item.product_id === p.id ? 'selected' : ''}>${p.name} (TK: ${inv})</option>`;\n                            }).join('')}\n                        </select>\n                        <div class=\"bulk-item-quantity\">\n                            <span style=\"font-size: 13px; color: var(--text-secondary);\">SL:</span>\n                            <input type=\"number\" class=\"bulk-qty-input\" value=\"${item.quantity}\" min=\"1\" max=\"${currentInv}\" onchange=\"updateBulkXuatItem(${item.id}, 'quantity', this.value)\">\n                        </div>\n                        <button class=\"bulk-remove-btn\" onclick=\"removeBulkXuatItem(${item.id})\">üóëÔ∏è</button>\n                    </div>\n                `;\n            }).join('');\n            \n            document.getElementById('bulk-xuat-count').textContent = bulkXuatItems.length;\n        }\n        \n        async function handleBulkNhap() {\n            if (bulkNhapItems.length === 0) {\n                showToast('error', 'Ch∆∞a c√≥ s·∫£n ph·∫©m n√†o!');\n                return;\n            }\n            \n            // Validate all items\n            for (const item of bulkNhapItems) {\n                if (!item.product_id || !item.quantity) {\n                    showToast('error', 'Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin!');\n                    return;\n                }\n            }\n            \n            const commonNote = document.getElementById('bulk-nhap-note').value;\n            \n            try {\n                showLoading();\n                let successCount = 0;\n                let failCount = 0;\n                \n                // Process each item sequentially (gi·ªØ c·∫•u tr√∫c data hi·ªán t·∫°i)\n                for (const item of bulkNhapItems) {\n                    try {\n                        const product = products.find(p => p.id === item.product_id);\n                        const note = commonNote ? `${commonNote} - ${product?.name}` : product?.name;\n                        \n                        const response = await apiCall('transactions', 'POST', {\n                            type: 'nhap',\n                            product_id: item.product_id,\n                            quantity: item.quantity,\n                            note: note,\n                        });\n                        \n                        if (response.success) {\n                            successCount++;\n                        } else {\n                            failCount++;\n                        }\n                    } catch (error) {\n                        failCount++;\n                        console.error('Bulk nhap item error:', error);\n                    }\n                }\n                \n                // Reload data\n                await loadTransactions();\n                await loadInventory();\n                updateDashboard();\n                \n                // Clear bulk list\n                bulkNhapItems = [];\n                renderBulkNhapList();\n                document.getElementById('bulk-nhap-note').value = '';\n                \n                showToast('success', `‚úÖ Nh·∫≠p ${successCount} s·∫£n ph·∫©m th√†nh c√¥ng${failCount > 0 ? `, ${failCount} th·∫•t b·∫°i` : ''}!`);\n                \n            } catch (error) {\n                showToast('error', 'L·ªói: ' + error.message);\n                logError('Bulk Nhap Error', error);\n            } finally {\n                hideLoading();\n            }\n        }\n        \n        async function handleBulkXuat() {\n            if (bulkXuatItems.length === 0) {\n                showToast('error', 'Ch∆∞a c√≥ s·∫£n ph·∫©m n√†o!');\n                return;\n            }\n            \n            // Validate all items\n            for (const item of bulkXuatItems) {\n                if (!item.product_id || !item.quantity) {\n                    showToast('error', 'Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin!');\n                    return;\n                }\n                \n                // Check inventory\n                const currentInv = inventory[currentPage]?.[item.product_id] || 0;\n                if (currentInv < item.quantity) {\n                    const product = products.find(p => p.id === item.product_id);\n                    showToast('error', `Kh√¥ng ƒë·ªß h√†ng: ${product?.name} (TK: ${currentInv})`);\n                    return;\n                }\n            }\n            \n            const commonNote = document.getElementById('bulk-xuat-note').value;\n            \n            try {\n                showLoading();\n                let successCount = 0;\n                let failCount = 0;\n                \n                // Process each item sequentially (gi·ªØ c·∫•u tr√∫c data hi·ªán t·∫°i)\n                for (const item of bulkXuatItems) {\n                    try {\n                        const product = products.find(p => p.id === item.product_id);\n                        const note = commonNote ? `${commonNote} - ${product?.name}` : product?.name;\n                        \n                        const response = await apiCall('transactions', 'POST', {\n                            type: 'xuat',\n                            product_id: item.product_id,\n                            quantity: item.quantity,\n                            note: note,\n                        });\n                        \n                        if (response.success) {\n                            successCount++;\n                        } else {\n                            failCount++;\n                        }\n                    } catch (error) {\n                        failCount++;\n                        console.error('Bulk xuat item error:', error);\n                    }\n                }\n                \n                // Reload data\n                await loadTransactions();\n                await loadInventory();\n                updateDashboard();\n                \n                // Clear bulk list\n                bulkXuatItems = [];\n                renderBulkXuatList();\n                document.getElementById('bulk-xuat-note').value = '';\n                \n                showToast('success', `‚úÖ Xu·∫•t ${successCount} s·∫£n ph·∫©m th√†nh c√¥ng${failCount > 0 ? `, ${failCount} th·∫•t b·∫°i` : ''}!`);\n                \n            } catch (error) {\n                showToast('error', 'L·ªói: ' + error.message);\n                logError('Bulk Xuat Error', error);\n            } finally {\n                hideLoading();\n            }\n        }\n        \n        // ===== BULK/SINGLE SWITCH FUNCTIONS =====\n        \n        function switchToBulkNhap() {\n            showSection('nhap-bulk');\n            // Auto add first row if empty\n            if (bulkNhapItems.length === 0) {\n                addBulkNhapRow();\n            }\n        }\n        \n        function switchToBulkXuat() {\n            showSection('xuat-bulk');\n            // Auto add first row if empty\n            if (bulkXuatItems.length === 0) {\n                addBulkXuatRow();\n            }\n        }\n        \n        function switchToSingleNhap() {\n            showSection('nhap');\n        }\n        \n        function switchToSingleXuat() {\n            showSection('xuat');\n        }\n        \n        // Call when authorized\n        if (document.readyState === 'loading') {\n            document.addEventListener('DOMContentLoaded', function() {\n                // Wait for init, will be called in setupEventListeners if authorized\n            });\n        }\n\n        // Configuration\n        const CONFIG = {\n            N8N_WEBHOOK_URL: 'https://n8n.tayninh.cloud/webhook',\n            API_PATH: 'api',\n        };\n\n        // Global State\n        let currentPage = 'RR88';\n        let currentSection = 'dashboard';\n        let products = [];\n        let transactions = [];\n        let inventory = {};\n        let allowedPages = [];\n        \n        // Dashboard State\n        let currentTimeFilter = 'week';\n        let chartInstance = null;\n        let currentChartType = 'bar';\n        let dashboardData = null;\n\n        // Telegram WebApp\n        let tg = window.Telegram?.WebApp;\n        let currentUser = 'Unknown';\n        let currentUserId = null;\n        \n        if (tg) {\n            tg.ready();\n\n            const mode = tg.initDataUnsafe?.start_param || 'full';\n\n            switch (mode) {\n                case 'compact':\n                    tg.setHeaderColor('secondary_bg_color');\n                    tg.disableClosingConfirmation();\n                    break;\n\n                case 'full':\n                    tg.expand();\n                    tg.setHeaderColor('bg_color');\n                    break;\n\n                case 'fullscreen':\n                    if (tg.requestFullscreen) {\n                        tg.requestFullscreen();\n                    } else {\n                        tg.expand();\n                    }\n                    break;\n            }\n\n            tg.MainButton.hide();\n            \n            const user = tg.initDataUnsafe?.user;\n            if (user) {\n                currentUser = user.first_name || user.username || 'Unknown';\n                currentUserId = user.id;\n            }\n            \n            const theme = tg.colorScheme || 'light';\n            document.documentElement.setAttribute('data-theme', theme);\n            \n            tg.onEvent('themeChanged', function() {\n                document.documentElement.setAttribute('data-theme', tg.colorScheme);\n            });\n        }\n\n        // [COPY TO√ÄN B·ªò PH·∫¶N JAVASCRIPT C√íN L·∫†I T·ª™ FILE G·ªêC]\n        // T·∫•t c·∫£ functions t·ª´ initializeApp() ƒë·∫øn h·∫øt file\n    </script>\n</body>\n</html>"
      },
      "type": "n8n-nodes-base.html",
      "typeVersion": 1.2,
      "position": [
        240,
        -32
      ],
      "id": "f7618ffd-cd8a-44c1-b57a-9d464f272b11",
      "name": "HTML"
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "={{ $json.html }}",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "text/html; charset=utf-8"
              }
            ]
          }
        }
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        448,
        -32
      ],
      "id": "6994818b-2c58-440c-9544-789f44434fc1",
      "name": "Respond to Serve HTML App"
    },
    {
      "parameters": {
        "path": "app",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        32,
        -32
      ],
      "id": "9940037e-8df5-4bd3-b3a0-66670797e360",
      "name": "App",
      "webhookId": "bb1400e8-541e-4808-8164-9cbc5deb761e"
    },
    {
      "parameters": {
        "path": "api",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        32,
        96
      ],
      "id": "617bd123-20f9-467d-b48c-90b975a1ebea",
      "name": "Api Get",
      "webhookId": "4c0055ce-d8e7-4901-b8fc-889123985786"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "api",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        16,
        560
      ],
      "id": "90796feb-d237-48ae-9033-633aa7bc09e0",
      "name": "Api Post",
      "webhookId": "4c0055ce-d8e7-4901-b8fc-889123985786"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.query.endpoint }}",
                    "rightValue": "products",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "e0cc0ede-e426-4755-923e-f24c8abb13a7"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "products"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "6f44da8c-98cf-486c-b723-c415c8ec9b54",
                    "leftValue": "={{ $json.query.endpoint }}",
                    "rightValue": "transactions",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "transactions"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "71ccf6c1-5a86-49af-8a45-0cddc2620606",
                    "leftValue": "={{ $json.query.endpoint }}",
                    "rightValue": "inventory",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "inventory"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "0dde49ad-b249-420c-a7aa-140fe5faeedb",
                    "leftValue": "={{ $json.query.endpoint }}",
                    "rightValue": "check_auth",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "check_auth"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        640,
        64
      ],
      "id": "e83e3d8e-beac-40a2-b0cb-a41663289296",
      "name": "Switch"
    },
    {
      "parameters": {
        "operation": "get",
        "dataTableId": {
          "__rl": true,
          "value": "SwDrMA6CIyw3ItDk",
          "mode": "list",
          "cachedResultName": "products",
          "cachedResultUrl": "/projects/R3q2BZJwo1KE2EhD/datatables/SwDrMA6CIyw3ItDk"
        },
        "filters": {
          "conditions": [
            {
              "keyName": "page",
              "keyValue": "={{ $json.query.page }}"
            }
          ]
        },
        "returnAll": true
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1,
      "position": [
        864,
        -96
      ],
      "id": "2c3c217f-943c-48ff-95b8-e5673de38f0a",
      "name": "Get row(s)",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "jsCode": "return [{ \n  json: {\n    success: true,\n    data: $input.all().map(i => i.json) \n  } \n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1072,
        -96
      ],
      "id": "ab9de1ba-072a-4321-89bb-69350d913a19",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json }}",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        1280,
        -96
      ],
      "id": "375d9cdd-24cb-479c-a706-49a213424321",
      "name": "Respond to Webhook"
    },
    {
      "parameters": {
        "operation": "get",
        "dataTableId": {
          "__rl": true,
          "value": "N641yEkFpe7bFtf8",
          "mode": "list",
          "cachedResultName": "transactions",
          "cachedResultUrl": "/projects/R3q2BZJwo1KE2EhD/datatables/N641yEkFpe7bFtf8"
        },
        "filters": {
          "conditions": [
            {
              "keyName": "page",
              "keyValue": "={{ $json.query.page }}"
            }
          ]
        },
        "returnAll": true
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1,
      "position": [
        864,
        32
      ],
      "id": "b69f8681-bd2e-44fd-bd04-a4022ea79b5f",
      "name": "Get row(s)1",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "operation": "get",
        "dataTableId": {
          "__rl": true,
          "value": "N641yEkFpe7bFtf8",
          "mode": "list",
          "cachedResultName": "transactions",
          "cachedResultUrl": "/projects/R3q2BZJwo1KE2EhD/datatables/N641yEkFpe7bFtf8"
        },
        "filters": {
          "conditions": [
            {
              "keyName": "page",
              "keyValue": "={{ $json.query.page }}"
            }
          ]
        },
        "returnAll": true
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1,
      "position": [
        864,
        160
      ],
      "id": "c7e3173b-4ef4-47f2-ade1-1a67f302e589",
      "name": "Get row(s)2",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json }}",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        1280,
        160
      ],
      "id": "bc6bb5cf-f128-4001-84fc-fbb11ce9605d",
      "name": "Respond to Webhook2"
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json }}",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        1280,
        32
      ],
      "id": "0796e583-5cd9-474e-97d3-7f9205e0d800",
      "name": "Respond to Webhook3"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.query.endpoint }}",
                    "rightValue": "products",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "e0cc0ede-e426-4755-923e-f24c8abb13a7"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "products"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "6f44da8c-98cf-486c-b723-c415c8ec9b54",
                    "leftValue": "={{ $json.query.endpoint }}",
                    "rightValue": "transactions",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "transactions"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "ce394bfc-ad08-4f75-b081-406624856f99",
                    "leftValue": "={{ $json.query.endpoint }}",
                    "rightValue": "sync_gsheet",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "sync_gsheet"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        448,
        544
      ],
      "id": "2c234ff7-e20c-4f16-a7b2-d9332db7531a",
      "name": "Switch1"
    },
    {
      "parameters": {
        "jsCode": "const body = $json.body;\n\n// Validate required fields\nif (!body.name || !body.unit || !body.page) {\n  throw new Error('Thi·∫øu th√¥ng tin b·∫Øt bu·ªôc');\n}\n\n// Prepare product data\nreturn [{\n  json: {\n    id: body.id,\n    name: body.name,\n    unit: body.unit,\n    description: body.description || '',\n    page: body.page\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        656,
        416
      ],
      "id": "dcd216a1-9bc8-489b-868a-4e304dfa514a",
      "name": "Code in JavaScript1"
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json }}",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        1488,
        544
      ],
      "id": "a88da87c-3038-422e-b8b9-bc74b05bf27c",
      "name": "Respond to Webhook4"
    },
    {
      "parameters": {
        "jsCode": "const body = $json.body;\n\n// Validate required fields\nif (!body.type || !body.product_id || !body.quantity) {\n  throw new Error('Thi·∫øu th√¥ng tin b·∫Øt bu·ªôc');\n}\n\nif (!body.page || !body.user) {\n  throw new Error('Thi·∫øu page ho·∫∑c user');\n}\n\nif (!['nhap', 'xuat'].includes(body.type)) {\n  throw new Error('Lo·∫°i kh√¥ng h·ª£p l·ªá');\n}\n\n// Prepare data ƒë·ªÉ insert\nreturn [{\n  json: {\n    type: body.type,\n    product_id: parseInt(body.product_id),\n    quantity: parseInt(body.quantity),\n    note: body.note || '',\n    page: body.page,\n    user: body.user  // First name t·ª´ Telegram\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        656,
        688
      ],
      "id": "868fe0dc-a377-44f1-84b6-302186fbd4db",
      "name": "Code in JavaScript2"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "a6758243-b7a4-4c2c-92f3-4e32ee8d3ca3",
              "leftValue": "={{ $json.type }}",
              "rightValue": "xuat",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        864,
        688
      ],
      "id": "48c6494e-bd3c-4a2e-aab1-13fa5e6c08d5",
      "name": "If"
    },
    {
      "parameters": {
        "operation": "get",
        "dataTableId": {
          "__rl": true,
          "value": "N641yEkFpe7bFtf8",
          "mode": "list",
          "cachedResultName": "transactions",
          "cachedResultUrl": "/projects/R3q2BZJwo1KE2EhD/datatables/N641yEkFpe7bFtf8"
        },
        "filters": {
          "conditions": [
            {
              "keyName": "page",
              "keyValue": "={{ $json.page }}"
            },
            {
              "keyName": "product_id",
              "keyValue": "={{ $json.product_id }}"
            }
          ]
        },
        "returnAll": true
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1,
      "position": [
        1072,
        672
      ],
      "id": "0f0eb575-d0a0-45d6-a381-a1012e77a562",
      "name": "Get row(s)3"
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json }}",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        1888,
        816
      ],
      "id": "dbb9e0c1-9453-491f-bcdf-265e40269cec",
      "name": "Respond to Webhook5"
    },
    {
      "parameters": {
        "dataTableId": {
          "__rl": true,
          "value": "N641yEkFpe7bFtf8",
          "mode": "list",
          "cachedResultName": "transactions",
          "cachedResultUrl": "/projects/R3q2BZJwo1KE2EhD/datatables/N641yEkFpe7bFtf8"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "product_id": "={{ $json.product_id }}",
            "quantity": "={{ $json.quantity }}",
            "type": "={{ $json.type }}",
            "page": "={{ $json.page }}",
            "note": "={{ $json.note }}",
            "user": "={{ $json.user }}",
            "timestamp": "={{ $now.toISO() }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "type",
              "displayName": "type",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "product_id",
              "displayName": "product_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "quantity",
              "displayName": "quantity",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "note",
              "displayName": "note",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "page",
              "displayName": "page",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "user",
              "displayName": "user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "timestamp",
              "displayName": "timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "readOnly": false,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1,
      "position": [
        1072,
        816
      ],
      "id": "4c22975c-0700-4ed7-a9a1-77cad3ac9d66",
      "name": "Insert row1"
    },
    {
      "parameters": {
        "jsCode": "return [{\n  json: {\n    success: true,\n    data: $input.all().map(i => i.json)\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1696,
        816
      ],
      "id": "a119efcc-a72f-464f-8467-3db58cf51a21",
      "name": "Code in JavaScript4"
    },
    {
      "parameters": {
        "jsCode": "const transactions = $input.all().map(item => {\n  const t = item.json;\n  return {\n    id: t.id,\n    type: t.type,\n    product_id: t.product_id,\n    quantity: t.quantity,\n    note: t.note || '',\n    page: t.page,\n    user: t.user || 'Unknown',\n    timestamp: t.timestamp\n  };\n});\n\nreturn [{\n  json: {\n    success: true,\n    data: transactions\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1072,
        32
      ],
      "id": "aa8caf31-4995-402e-8b42-5f33afb24624",
      "name": "Code in JavaScript5"
    },
    {
      "parameters": {
        "jsCode": "return [{\n  json: {\n    success: true,\n    data: $input.all().map(i => i.json)\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1280,
        544
      ],
      "id": "bdf842ba-4d92-4c37-9fb1-a43fd870525b",
      "name": "Code in JavaScript6"
    },
    {
      "parameters": {
        "jsCode": "const transactions = $input.all();\nconst inventory = {};\n\ntransactions.forEach(item => {\n  const t = item.json;\n  const productId = t.product_id;\n  \n  if (!inventory[productId]) {\n    inventory[productId] = 0;\n  }\n  \n  if (t.type === 'nhap') {\n    inventory[productId] += parseInt(t.quantity);\n  } else {\n    inventory[productId] -= parseInt(t.quantity);\n  }\n});\n\nconst result = Object.entries(inventory).map(([id, qty]) => ({\n  product_id: parseInt(id),\n  quantity: qty\n}));\n\nreturn [{\n  json: {\n    success: true,\n    data: result\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1072,
        160
      ],
      "id": "52fed92a-5b36-4f1c-936b-e3967506dd24",
      "name": "Code in JavaScript7"
    },
    {
      "parameters": {
        "jsCode": "const newTransaction = $('Code in JavaScript2').item.json; // Transaction m·ªõi\nconst existingTrans = $input.all().map(i => i.json);\n\n// T√≠nh t·ªìn kho hi·ªán t·∫°i\nlet currentInventory = 0;\n\nexistingTrans.forEach(t => {\n  if (t.type === 'nhap') {\n    currentInventory += parseInt(t.quantity);\n  } else if (t.type === 'xuat') {\n    currentInventory -= parseInt(t.quantity);\n  }\n});\n\n// Check ƒë·ªß h√†ng kh√¥ng\nconst requestedQty = newTransaction.quantity;\n\nif (currentInventory < requestedQty) {\n  throw new Error(`Kh√¥ng ƒë·ªß h√†ng! T·ªìn kho: ${currentInventory}, Y√™u c·∫ßu: ${requestedQty}`);\n}\n\n// OK ‚Üí Tr·∫£ v·ªÅ transaction ƒë·ªÉ insert\nreturn [{\n  json: newTransaction\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1280,
        672
      ],
      "id": "e9251a76-2c0d-4088-bffe-3b1f184e31ae",
      "name": "Code in JavaScript3"
    },
    {
      "parameters": {
        "dataTableId": {
          "__rl": true,
          "value": "N641yEkFpe7bFtf8",
          "mode": "list",
          "cachedResultName": "transactions",
          "cachedResultUrl": "/projects/R3q2BZJwo1KE2EhD/datatables/N641yEkFpe7bFtf8"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "product_id": "={{ $json.product_id }}",
            "quantity": "={{ $json.quantity }}",
            "type": "={{ $json.type }}",
            "note": "={{ $json.note }}",
            "page": "={{ $json.page }}",
            "user": "={{ $json.user }}",
            "timestamp": "={{ $now.toISO() }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "type",
              "displayName": "type",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "product_id",
              "displayName": "product_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "quantity",
              "displayName": "quantity",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "note",
              "displayName": "note",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "page",
              "displayName": "page",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "user",
              "displayName": "user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "timestamp",
              "displayName": "timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "readOnly": false,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1,
      "position": [
        1488,
        672
      ],
      "id": "95b75311-438c-440f-b223-18f5290a1309",
      "name": "Insert row2"
    },
    {
      "parameters": {
        "dataTableId": {
          "__rl": true,
          "value": "SwDrMA6CIyw3ItDk",
          "mode": "list",
          "cachedResultName": "products",
          "cachedResultUrl": "/projects/R3q2BZJwo1KE2EhD/datatables/SwDrMA6CIyw3ItDk"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "created_at": "={{ $now.toISO() }}",
            "name": "={{ $json.name }}",
            "unit": "={{ $json.unit }}",
            "description": "={{ $json.description }}",
            "page": "={{ $json.page }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "name",
              "displayName": "name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "unit",
              "displayName": "unit",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "description",
              "displayName": "description",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "page",
              "displayName": "page",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "readOnly": false,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1,
      "position": [
        1072,
        544
      ],
      "id": "14cd5f0e-9627-4b25-a11f-88883b41d151",
      "name": "Insert row"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "61517148-8050-4e57-bc41-2ee70c64f694",
              "leftValue": "={{ $json.id }}",
              "rightValue": "true",
              "operator": {
                "type": "number",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        864,
        416
      ],
      "id": "ccaed51f-2b43-4245-a26c-e55f4856f7a2",
      "name": "If2"
    },
    {
      "parameters": {
        "operation": "update",
        "dataTableId": {
          "__rl": true,
          "value": "SwDrMA6CIyw3ItDk",
          "mode": "list",
          "cachedResultName": "products",
          "cachedResultUrl": "/projects/R3q2BZJwo1KE2EhD/datatables/SwDrMA6CIyw3ItDk"
        },
        "filters": {
          "conditions": [
            {
              "keyValue": "={{ $json.id }}"
            }
          ]
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "name": "={{ $json.name }}",
            "unit": "={{ $json.unit }}",
            "description": "={{ $json.description }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "name",
              "displayName": "name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "unit",
              "displayName": "unit",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "description",
              "displayName": "description",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "page",
              "displayName": "page",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "readOnly": false,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1,
      "position": [
        1072,
        416
      ],
      "id": "062cef3e-96b4-4210-928b-6ec6e6b38c77",
      "name": "Update row(s)"
    },
    {
      "parameters": {
        "operation": "get",
        "dataTableId": {
          "__rl": true,
          "value": "hd6LzamNqGeRGRmz",
          "mode": "list",
          "cachedResultName": "allowed_users",
          "cachedResultUrl": "/projects/R3q2BZJwo1KE2EhD/datatables/hd6LzamNqGeRGRmz"
        },
        "filters": {
          "conditions": [
            {
              "keyName": "telegram_id",
              "keyValue": "={{ $json.query.user_id }}"
            }
          ]
        },
        "returnAll": true
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1,
      "position": [
        864,
        288
      ],
      "id": "ca57d725-4c77-4b4f-a8af-185ad01fc53d",
      "name": "Get row(s)5",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "jsCode": "const users = $input.all();\n\nif (users.length === 0) {\n  return [{\n    json: {\n      success: false,\n      authorized: false,\n      message: 'Kh√¥ng c√≥ quy·ªÅn truy c·∫≠p'\n    }\n  }];\n}\n\nconst user = users[0].json;\n\nif (!user.active) {\n  return [{\n    json: {\n      success: false,\n      authorized: false,\n      message: 'T√†i kho·∫£n ƒë√£ b·ªã kh√≥a'\n    }\n  }];\n}\n\nreturn [{\n  json: {\n    success: true,\n    authorized: true,\n    pages: user.pages  // \"RR88,XX88,MM88\" ho·∫∑c \"MM88\"\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1072,
        288
      ],
      "id": "924c7610-2367-4425-a68a-fab74f948ad3",
      "name": "Code in JavaScript9"
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json }}",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        1280,
        288
      ],
      "id": "cddb5109-ab32-4913-86c6-caea0a6612b6",
      "name": "Respond to Webhook6"
    },
    {
      "parameters": {
        "updates": [
          "message"
        ],
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.2,
      "position": [
        -112,
        880
      ],
      "id": "131d14c3-ec6d-4bba-982f-dec760a0a1c8",
      "name": "Telegram Trigger",
      "webhookId": "a505b2c1-07bf-48a5-896f-782c504e3368",
      "credentials": {
        "telegramApi": {
          "id": "UQ2c0WsJ6oAyL2X9",
          "name": "Tr·ª£ L√Ω IT"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "fa97bafd-d7b4-4d62-83af-bd9774bf1e26",
              "leftValue": "={{ $json.message.text }}",
              "rightValue": "/start",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        80,
        880
      ],
      "id": "a48398b8-09be-42f7-90fb-fc011dd2b50b",
      "name": "If1"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "ü§ñ Vui l√≤ng b·∫•m v√†o n√∫t n√†y ƒë·ªÉ truy c·∫≠p! üëâ",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Qu·∫£n L√Ω H√†ng",
                    "additionalFields": {
                      "url": "https://t.me/trolyitbot?startapp=fullscreen"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        480,
        880
      ],
      "id": "74b2bf4d-7703-45a0-ac99-07da0e7a88ae",
      "name": "Send a text message",
      "webhookId": "a575b094-e428-4d45-98c1-7eb57179e876",
      "credentials": {
        "telegramApi": {
          "id": "UQ2c0WsJ6oAyL2X9",
          "name": "Tr·ª£ L√Ω IT"
        }
      }
    },
    {
      "parameters": {
        "operation": "deleteMessage",
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "messageId": "={{ $('Telegram Trigger').item.json.message.message_id }}"
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        288,
        880
      ],
      "id": "c9012695-dc65-4dd9-a486-0253aa9b16b1",
      "name": "Delete a chat message",
      "webhookId": "7b6f4b9d-6d29-4ab3-a532-638737d118d1",
      "credentials": {
        "telegramApi": {
          "id": "UQ2c0WsJ6oAyL2X9",
          "name": "Tr·ª£ L√Ω IT"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const body = $input.first().json.body;\n\nreturn [{\n  json: {\n    inventory: body.inventory,\n    transactions: body.transactions,\n    sync_time: body.sync_time,\n    synced_by: body.synced_by\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        656,
        992
      ],
      "id": "bf6759fe-4799-423e-b8e7-e541d296a9fa",
      "name": "Code in JavaScript8"
    },
    {
      "parameters": {
        "fieldToSplitOut": "inventory.RR88",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        864,
        992
      ],
      "id": "ab93d471-bbb9-4c48-a65e-fc040c13c888",
      "name": "Split Out"
    },
    {
      "parameters": {
        "fieldToSplitOut": "inventory.XX88",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        864,
        1136
      ],
      "id": "42cd384b-0bd3-42ba-81cf-60419f0dd7ce",
      "name": "Split Out1"
    },
    {
      "parameters": {
        "fieldToSplitOut": "inventory.MM88",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        864,
        1280
      ],
      "id": "82c2adb3-655c-44bb-b3a5-b70d5c5901dc",
      "name": "Split Out2"
    },
    {
      "parameters": {
        "fieldToSplitOut": "transactions",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        864,
        1424
      ],
      "id": "29b9c064-a07c-4466-881b-4c60a98b459c",
      "name": "Split Out3"
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "1K91_IuTBxrsQJJROidZD7OxIcMGiQ4cMdoopfFbzKM0",
          "mode": "list",
          "cachedResultName": "Bi·ªÉu Xu·∫•t Nh·∫≠p H√†ng - IT",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1K91_IuTBxrsQJJROidZD7OxIcMGiQ4cMdoopfFbzKM0/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "RR88",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1K91_IuTBxrsQJJROidZD7OxIcMGiQ4cMdoopfFbzKM0/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "ID": "={{ $json.id }}",
            "S·∫£n Ph·∫©m": "={{ $json.name }}",
            "ƒê∆°n V·ªã": "={{ $json.unit }}",
            "T·ªìn Kho": "={{ $json.quantity }}",
            "M√¥ T·∫£": "={{ $json.description || \"Kh√¥ng c√≥\" }}"
          },
          "matchingColumns": [
            "ID"
          ],
          "schema": [
            {
              "id": "ID",
              "displayName": "ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "S·∫£n Ph·∫©m",
              "displayName": "S·∫£n Ph·∫©m",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "T·ªìn Kho",
              "displayName": "T·ªìn Kho",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "ƒê∆°n V·ªã",
              "displayName": "ƒê∆°n V·ªã",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "M√¥ T·∫£",
              "displayName": "M√¥ T·∫£",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1072,
        992
      ],
      "id": "6dfa4bbd-1299-4104-ad18-c53f013146b3",
      "name": "Append or update row in sheet",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "9JBRAp3RhxzSvC2Z",
          "name": "Google Sheets"
        }
      }
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "1K91_IuTBxrsQJJROidZD7OxIcMGiQ4cMdoopfFbzKM0",
          "mode": "list",
          "cachedResultName": "Bi·ªÉu Xu·∫•t Nh·∫≠p H√†ng - IT",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1K91_IuTBxrsQJJROidZD7OxIcMGiQ4cMdoopfFbzKM0/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1214191780,
          "mode": "list",
          "cachedResultName": "XX88",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1K91_IuTBxrsQJJROidZD7OxIcMGiQ4cMdoopfFbzKM0/edit#gid=1214191780"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "ID": "={{ $json.id }}",
            "S·∫£n Ph·∫©m": "={{ $json.name }}",
            "ƒê∆°n V·ªã": "={{ $json.unit }}",
            "T·ªìn Kho": "={{ $json.quantity }}",
            "M√¥ T·∫£": "={{ $json.description || \"Kh√¥ng c√≥\" }}"
          },
          "matchingColumns": [
            "ID"
          ],
          "schema": [
            {
              "id": "ID",
              "displayName": "ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "S·∫£n Ph·∫©m",
              "displayName": "S·∫£n Ph·∫©m",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "T·ªìn Kho",
              "displayName": "T·ªìn Kho",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "ƒê∆°n V·ªã",
              "displayName": "ƒê∆°n V·ªã",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "M√¥ T·∫£",
              "displayName": "M√¥ T·∫£",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1072,
        1136
      ],
      "id": "3e84fe8b-b238-49b9-bc76-11f5fe318d95",
      "name": "Append or update row in sheet1",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "9JBRAp3RhxzSvC2Z",
          "name": "Google Sheets"
        }
      }
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "1K91_IuTBxrsQJJROidZD7OxIcMGiQ4cMdoopfFbzKM0",
          "mode": "list",
          "cachedResultName": "Bi·ªÉu Xu·∫•t Nh·∫≠p H√†ng - IT",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1K91_IuTBxrsQJJROidZD7OxIcMGiQ4cMdoopfFbzKM0/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 270763252,
          "mode": "list",
          "cachedResultName": "MM88",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1K91_IuTBxrsQJJROidZD7OxIcMGiQ4cMdoopfFbzKM0/edit#gid=270763252"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "ID": "={{ $json.id }}",
            "S·∫£n Ph·∫©m": "={{ $json.name }}",
            "ƒê∆°n V·ªã": "={{ $json.unit }}",
            "T·ªìn Kho": "={{ $json.quantity }}",
            "M√¥ T·∫£": "={{ $json.description || \"Kh√¥ng c√≥\" }}"
          },
          "matchingColumns": [
            "ID"
          ],
          "schema": [
            {
              "id": "ID",
              "displayName": "ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "S·∫£n Ph·∫©m",
              "displayName": "S·∫£n Ph·∫©m",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "T·ªìn Kho",
              "displayName": "T·ªìn Kho",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "ƒê∆°n V·ªã",
              "displayName": "ƒê∆°n V·ªã",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "M√¥ T·∫£",
              "displayName": "M√¥ T·∫£",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1072,
        1280
      ],
      "id": "b56ca154-6664-4449-9630-caca3861cc05",
      "name": "Append or update row in sheet2",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "9JBRAp3RhxzSvC2Z",
          "name": "Google Sheets"
        }
      }
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "1K91_IuTBxrsQJJROidZD7OxIcMGiQ4cMdoopfFbzKM0",
          "mode": "list",
          "cachedResultName": "Bi·ªÉu Xu·∫•t Nh·∫≠p H√†ng - IT",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1K91_IuTBxrsQJJROidZD7OxIcMGiQ4cMdoopfFbzKM0/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1439940515,
          "mode": "list",
          "cachedResultName": "L·ªãch S·ª≠",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1K91_IuTBxrsQJJROidZD7OxIcMGiQ4cMdoopfFbzKM0/edit#gid=1439940515"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "ID": "={{ $json.id }}",
            "Ng√†y Gi·ªù": "={{ $json.timestamp }}",
            "Trang": "={{ $json.page }}",
            "Lo·∫°i": "={{ $json.type }}",
            "S·ªë L∆∞·ª£ng": "={{ $json.quantity }}",
            "S·∫£n Ph·∫©m": "={{ $json.product }}",
            "Ghi Ch√∫": "={{ $json.note }}",
            "Ng∆∞·ªùi": "={{ $json.user }}"
          },
          "matchingColumns": [
            "ID"
          ],
          "schema": [
            {
              "id": "ID",
              "displayName": "ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Ng∆∞·ªùi",
              "displayName": "Ng∆∞·ªùi",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Lo·∫°i",
              "displayName": "Lo·∫°i",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "S·∫£n Ph·∫©m",
              "displayName": "S·∫£n Ph·∫©m",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "S·ªë L∆∞·ª£ng",
              "displayName": "S·ªë L∆∞·ª£ng",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Ghi Ch√∫",
              "displayName": "Ghi Ch√∫",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Trang",
              "displayName": "Trang",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Ng√†y Gi·ªù",
              "displayName": "Ng√†y Gi·ªù",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1072,
        1424
      ],
      "id": "faea11d6-811f-4eba-8979-7f44f06ac873",
      "name": "Append or update row in sheet3",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "9JBRAp3RhxzSvC2Z",
          "name": "Google Sheets"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "return [{\n  json: {\n    success: true,\n    spreadsheetUrl: 'https://docs.google.com/spreadsheets/d/1K91_IuTBxrsQJJROidZD7OxIcMGiQ4cMdoopfFbzKM0',\n    message: 'ƒê·ªìng b·ªô th√†nh c√¥ng',\n    sheets: ['RR88', 'XX88', 'MM88', 'L·ªãch S·ª≠'],\n    synced_at: new Date().toISOString()\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1280,
        992
      ],
      "id": "7cdb6c25-2794-44ff-813f-7b66c459ef8a",
      "name": "Code in JavaScript10",
      "executeOnce": true
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json }}",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        1488,
        992
      ],
      "id": "10737162-c8e2-4bea-8792-9158256f5f11",
      "name": "Respond to Webhook1",
      "executeOnce": true
    }
  ],
  "pinData": {},
  "connections": {
    "HTML": {
      "main": [
        [
          {
            "node": "Respond to Serve HTML App",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "App": {
      "main": [
        [
          {
            "node": "HTML",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Api Get": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Api Post": {
      "main": [
        [
          {
            "node": "Switch1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Get row(s)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get row(s)1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get row(s)2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get row(s)5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s)": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s)1": {
      "main": [
        [
          {
            "node": "Code in JavaScript5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s)2": {
      "main": [
        [
          {
            "node": "Code in JavaScript7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch1": {
      "main": [
        [
          {
            "node": "Code in JavaScript1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Code in JavaScript2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Code in JavaScript8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript1": {
      "main": [
        [
          {
            "node": "If2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript2": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Get row(s)3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Insert row1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s)3": {
      "main": [
        [
          {
            "node": "Code in JavaScript3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Insert row1": {
      "main": [
        [
          {
            "node": "Code in JavaScript4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript4": {
      "main": [
        [
          {
            "node": "Respond to Webhook5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript5": {
      "main": [
        [
          {
            "node": "Respond to Webhook3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript6": {
      "main": [
        [
          {
            "node": "Respond to Webhook4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript7": {
      "main": [
        [
          {
            "node": "Respond to Webhook2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript3": {
      "main": [
        [
          {
            "node": "Insert row2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Insert row2": {
      "main": [
        [
          {
            "node": "Code in JavaScript4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Insert row": {
      "main": [
        [
          {
            "node": "Code in JavaScript6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If2": {
      "main": [
        [
          {
            "node": "Update row(s)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Insert row",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update row(s)": {
      "main": [
        [
          {
            "node": "Code in JavaScript6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s)5": {
      "main": [
        [
          {
            "node": "Code in JavaScript9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript9": {
      "main": [
        [
          {
            "node": "Respond to Webhook6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Telegram Trigger": {
      "main": [
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "Delete a chat message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a text message": {
      "main": [
        []
      ]
    },
    "Delete a chat message": {
      "main": [
        [
          {
            "node": "Send a text message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript8": {
      "main": [
        [
          {
            "node": "Split Out",
            "type": "main",
            "index": 0
          },
          {
            "node": "Split Out1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Split Out2",
            "type": "main",
            "index": 0
          },
          {
            "node": "Split Out3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out": {
      "main": [
        [
          {
            "node": "Append or update row in sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out1": {
      "main": [
        [
          {
            "node": "Append or update row in sheet1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out2": {
      "main": [
        [
          {
            "node": "Append or update row in sheet2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out3": {
      "main": [
        [
          {
            "node": "Append or update row in sheet3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append or update row in sheet": {
      "main": [
        [
          {
            "node": "Code in JavaScript10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append or update row in sheet1": {
      "main": [
        [
          {
            "node": "Code in JavaScript10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append or update row in sheet2": {
      "main": [
        [
          {
            "node": "Code in JavaScript10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append or update row in sheet3": {
      "main": [
        [
          {
            "node": "Code in JavaScript10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript10": {
      "main": [
        [
          {
            "node": "Respond to Webhook1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "6d07a05f-a684-4368-aab1-3743c28a109e",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "72f89004557badfea825f51bff69fe304cb7334d184129727cbca3d63ff0d5d5"
  },
  "id": "wDtYVoAfaDhK1FuA",
  "tags": [
    {
      "updatedAt": "2025-11-06T15:31:52.965Z",
      "createdAt": "2025-11-06T15:31:52.965Z",
      "id": "72V7NO6I54TjcU7f",
      "name": "Inventory Management"
    },
    {
      "updatedAt": "2025-09-01T17:07:15.088Z",
      "createdAt": "2025-09-01T17:07:15.088Z",
      "id": "JAXHVgW1wAEfBwtT",
      "name": "Telegram"
    },
    {
      "updatedAt": "2025-11-06T14:40:56.599Z",
      "createdAt": "2025-11-06T14:40:56.599Z",
      "id": "Nt50zQ0ZFCYlDptH",
      "name": "Telegram Mini App"
    }
  ]
}